<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>UAE Properties - Buy, Rent & Sell Premium Real Estate in Dubai, Abu Dhabi</title>
    <meta name="description" content="UAE Properties - Find premium apartments, villas, studios for rent and sale in Dubai, Abu Dhabi, Sharjah and all UAE emirates. Best real estate portal.">
    <meta name="keywords" content="UAE properties, Dubai real estate, apartments for rent Dubai, villas for sale Abu Dhabi, property portal UAE, buy property UAE, rent apartment Dubai">
    <meta name="robots" content="index, follow">
    <meta name="author" content="UAE Properties Portal">
    <link rel="canonical" href="https://uaeproperties.com">
    <meta property="og:type" content="website">
    <meta property="og:title" content="UAE Properties - Premium Real Estate Portal">
    <meta property="og:description" content="Find apartments, villas & commercial properties for rent and sale across UAE.">
    <meta property="og:url" content="https://uaeproperties.com">
    <meta property="og:site_name" content="UAE Properties">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="UAE Properties - Premium Real Estate">
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"RealEstateAgent","name":"UAE Properties","description":"Premium real estate portal for UAE properties","url":"https://uaeproperties.com","areaServed":{"@type":"Country","name":"United Arab Emirates"}}</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"></noscript>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif}
        :root{
            --primary:#c9a227;--primary-dark:#b48a1a;
            --bg-primary:#0b1423;--bg-secondary:#141f33;
            --bg-card:#ffffff;--border:#2a3b57;
            --text-primary:#ffffff;--text-secondary:#fef3c7;
            --text-muted:#9aa8b9;--danger:#ef4444;
            --warning:#f59e0b;--success:#10b981;--gold:#fbbf24
        }
        ::-webkit-scrollbar{width:8px;height:8px}
        ::-webkit-scrollbar-track{background:var(--bg-secondary);border-radius:10px}
        ::-webkit-scrollbar-thumb{background:var(--border);border-radius:10px;border:2px solid var(--bg-secondary)}
        ::-webkit-scrollbar-thumb:hover{background:var(--primary)}
        *{scrollbar-width:thin;scrollbar-color:var(--border) var(--bg-secondary)}
        body{background-color:var(--bg-primary);color:var(--text-primary);overflow-x:hidden}

        /* ===== LOGIN ===== */
        .login-page{min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px;background:linear-gradient(rgba(0,0,0,0.75),rgba(0,0,0,0.75)),url('https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=800') center/cover no-repeat}
        .login-container{background:rgba(255,255,255,0.98);padding:30px;border-radius:20px;width:100%;max-width:420px;box-shadow:0 20px 50px rgba(0,0,0,0.3);border:1px solid rgba(201,162,39,0.3)}
        .header-brand{text-align:center;margin-bottom:25px}
        .header-logo{width:100px;height:100px;object-fit:contain;margin-bottom:15px;filter:drop-shadow(0 4px 8px rgba(201,162,39,0.3))}
        .header-brand h1{color:#1f3f5b;font-size:22px;font-weight:700;margin-bottom:5px}
        .subtitle{color:#333;font-size:15px;font-weight:500}
        .login-tabs{display:flex;gap:1rem;margin-bottom:2rem}
        .login-tab{flex:1;padding:1rem;background:#f5f5f5;border:2px solid #ddd;border-radius:10px;color:#333;cursor:pointer;text-align:center;font-weight:500;transition:all 0.3s}
        .login-tab.active{border-color:var(--primary);color:var(--primary);background:rgba(201,162,39,0.1)}
        .login-form .form-group{margin-bottom:1.5rem}
        .login-form label{display:block;margin-bottom:0.5rem;color:#333;font-size:0.9rem;font-weight:500}
        .login-form input{width:100%;padding:1rem;background:#fff;border:2px solid #ddd;border-radius:10px;color:#333;font-size:1rem;transition:all 0.3s}
        .login-form input:focus{outline:none;border-color:var(--primary)}
        .login-btn{width:100%;padding:1rem;background:var(--primary);color:#000;border:none;border-radius:10px;font-size:1rem;font-weight:600;cursor:pointer;transition:all 0.3s;margin-top:1rem}
        .login-btn:hover{background:var(--primary-dark);transform:translateY(-2px);box-shadow:0 5px 20px rgba(201,162,39,0.3)}

        /* ===== DASHBOARD ===== */
        .dashboard{display:none}
        .dashboard.active{display:block}

        /* ===== NAVBAR ===== */
        .navbar{background:linear-gradient(135deg,#0b1423 0%,#1a2a45 100%);padding:0.8rem 2rem;display:flex;justify-content:space-between;align-items:center;border-bottom:3px solid var(--primary);position:fixed;width:100%;top:0;z-index:1000;flex-wrap:wrap;box-shadow:0 4px 20px rgba(0,0,0,0.3)}
        .logo-box{display:flex;align-items:center;gap:12px}
        .logo-img{width:55px;height:55px;object-fit:contain;filter:brightness(0) invert(1)}
        .logo-text{font-size:24px;font-weight:700;color:var(--primary);line-height:1.2;text-shadow:0 2px 4px rgba(0,0,0,0.3)}
        .logo-text span{display:block;font-size:14px;font-weight:500;color:#fff}
        .nav-links{display:flex;gap:2rem;align-items:center}
        .nav-link{color:#fff;text-decoration:none;font-size:12px;transition:all 0.3s;cursor:pointer;padding:0.5rem 1rem;border-radius:8px;position:relative;overflow:hidden}
        .nav-link::before{content:'';position:absolute;bottom:0;left:0;width:100%;height:2px;background:var(--primary);transform:translateX(-100%);transition:transform 0.3s}
        .nav-link:hover::before,.nav-link.active::before{transform:translateX(0)}
        .nav-link:hover,.nav-link.active{color:var(--primary);background:rgba(201,162,39,0.1)}
        .user-info{display:flex;align-items:center;gap:1rem;padding:0.5rem 1rem;background:rgba(255,255,255,0.05);border-radius:50px;border:2px solid var(--border);backdrop-filter:blur(10px)}
        .user-avatar{width:25px;height:25px;background:linear-gradient(135deg,var(--primary) 0%,#ffd700 100%);border-radius:50%;display:flex;align-items:center;justify-content:center;color:#0b1423;font-weight:bold;border:2px solid #fff}
        .user-details{line-height:1.4}
        .user-name{font-weight:400;color:#fff}
        .user-type{font-size:0.8rem;color:var(--primary)}
        .logout-btn{background:transparent;border:2px solid var(--border);color:#fff;padding:0.5rem 1.5rem;border-radius:25px;cursor:pointer;transition:all 0.3s;font-weight:500}
        .logout-btn:hover{border-color:var(--danger);color:var(--danger);background:rgba(239,68,68,0.1)}

        @media(max-width:768px){
            .navbar{flex-wrap:wrap;padding:10px 12px;gap:8px}
            .logo-box{flex:1;min-width:0}
            .logo-img{width:34px;height:34px}
            .logo-text{font-size:14px;white-space:nowrap}
            .logo-text span{display:none}
            .user-info{margin-left:auto;background:transparent;padding:0}
            .user-details{display:none}
            .user-avatar{width:30px;height:30px;font-size:13px}
            .nav-links{order:3;width:100%;justify-content:space-between;margin-top:8px;gap:8px}
            .nav-link,.logout-btn{flex:1;text-align:center;font-size:13px;padding:8px 6px;white-space:nowrap}
        }

        /* ===== MAIN LAYOUT ===== */
        .main-container{display:flex;margin-top:80px;min-height:calc(100vh - 80px)}
        @media(max-width:1024px){.main-container{flex-direction:column;margin-top:120px}}
        @media(max-width:768px){.main-container{margin-top:180px}}
        @media(max-width:480px){.main-container{margin-top:220px}}

        /* ===== SIDEBAR ===== */
        .filters-sidebar{width:320px;background:var(--bg-secondary);padding:2rem 1.5rem;position:fixed;height:calc(100vh - 80px);overflow-y:auto;border-right:2px solid var(--border)}
        @media(max-width:1024px){.filters-sidebar{width:100%;height:auto;position:relative;padding:1rem}}
        .filters-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;position:sticky;top:0;background:var(--bg-secondary);padding:1rem 0;z-index:10}
        .filters-header h3{color:var(--primary);font-size:1.2rem;display:flex;align-items:center;gap:0.5rem}
        .clear-filters{color:var(--text-muted);cursor:pointer;font-size:0.9rem;transition:color 0.3s;display:flex;align-items:center;gap:0.3rem}
        .clear-filters:hover{color:var(--primary)}
        .filter-section{margin-bottom:2rem;padding-bottom:1.5rem;border-bottom:2px solid var(--border)}
        .filter-section h4{color:var(--text-primary);margin-bottom:1rem;font-size:1rem;display:flex;align-items:center;gap:0.5rem}
        .filter-section h4 i{color:var(--primary)}
        .filter-options{display:flex;flex-direction:column;gap:0.8rem;max-height:200px;overflow-y:auto;padding-right:0.5rem}
        .filter-checkbox{display:flex;align-items:center;gap:0.5rem;color:var(--text-secondary);cursor:pointer;padding:0.3rem;border-radius:5px;transition:background 0.3s}
        .filter-checkbox:hover{background:rgba(255,255,255,0.1)}
        .filter-checkbox input[type="checkbox"]{accent-color:var(--primary);width:18px;height:18px;cursor:pointer}
        .filter-select{width:100%;padding:0.8rem;background:var(--bg-card);border:2px solid var(--border);border-radius:10px;color:#333;margin-bottom:0.5rem;cursor:pointer}
        .filter-select:focus{outline:none;border-color:var(--primary)}
        .price-range{display:flex;gap:0.5rem}
        .price-range input{width:50%;padding:0.8rem;background:var(--bg-card);border:2px solid var(--border);border-radius:10px;color:#333}
        .price-range input:focus{outline:none;border-color:var(--primary)}
        .radio-group{display:flex;flex-direction:column;gap:0.5rem}
        .radio-label{display:flex;align-items:center;gap:0.5rem;color:var(--text-secondary);cursor:pointer;padding:0.3rem;border-radius:5px;transition:background 0.3s}
        .radio-label:hover{background:rgba(255,255,255,0.1)}
        .radio-label input[type="radio"]{accent-color:var(--primary);width:18px;height:18px;cursor:pointer}
        .apply-filters-btn{width:100%;padding:1rem;background:var(--primary);color:#000;border:none;border-radius:10px;font-weight:600;cursor:pointer;transition:all 0.3s;margin-top:1rem;display:flex;align-items:center;justify-content:center;gap:0.5rem}
        .apply-filters-btn:hover{background:var(--primary-dark);transform:translateY(-2px);box-shadow:0 5px 20px rgba(201,162,39,0.3)}
        .content-area{flex:1;margin-left:320px;padding:2rem}
        @media(max-width:1024px){.content-area{margin-left:0;padding:1rem}}
        .add-area-input{display:flex;gap:0.5rem;margin-top:0.5rem}
        .area-list{max-height:150px;overflow-y:auto;border:2px solid var(--border);border-radius:10px;padding:0.5rem;margin-top:0.5rem}

        /* ===== UPLOAD FORM - FULLY MOBILE RESPONSIVE ===== */
        .upload-form{background:var(--bg-secondary);padding:2rem;border-radius:20px;border:2px solid var(--border);max-width:900px;margin:0 auto}
        @media(max-width:600px){.upload-form{padding:1rem 0.8rem;border-radius:12px}}
        .upload-form h2{color:var(--primary);margin-bottom:2rem;text-align:center;font-size:clamp(1.1rem,4vw,1.6rem)}
        .form-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}
        @media(max-width:600px){.form-grid{grid-template-columns:1fr;gap:0.7rem}}
        .form-group{margin-bottom:0.5rem}
        .form-group.full-width{grid-column:span 2}
        @media(max-width:600px){.form-group.full-width{grid-column:span 1}}
        .form-group label{display:block;margin-bottom:0.4rem;color:var(--text-secondary);font-size:0.85rem;font-weight:500}
        .form-group input,.form-group select,.form-group textarea{width:100%;padding:0.75rem;background:var(--bg-card);border:2px solid var(--border);border-radius:10px;color:#333;font-size:0.9rem;transition:border-color 0.3s;font-family:'Poppins',sans-serif}
        .form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:var(--primary)}
        .form-group textarea{height:100px;resize:vertical}
        @media(max-width:600px){
            .form-group input,.form-group select,.form-group textarea{padding:0.65rem;font-size:16px}
            .form-group textarea{height:80px}
        }

        /* ===== VIDEO UPLOAD SECTION IN FORM ===== */
        .video-upload-section{grid-column:span 2;background:#1a2a45;border:2px solid var(--border);border-radius:14px;padding:1.2rem;margin-top:0.5rem}
        @media(max-width:600px){.video-upload-section{grid-column:span 1;padding:0.9rem}}
        .video-upload-section h3{color:var(--primary);margin-bottom:1rem;font-size:14px;display:flex;align-items:center;gap:8px}
        .video-tabs{display:flex;gap:8px;margin-bottom:1rem;flex-wrap:wrap}
        .video-tab-btn{padding:8px 16px;border:2px solid var(--border);border-radius:20px;background:transparent;color:var(--text-muted);cursor:pointer;font-size:12px;font-weight:500;transition:all 0.3s;font-family:'Poppins',sans-serif}
        .video-tab-btn.active{background:var(--primary);color:#000;border-color:var(--primary)}
        .video-tab-content{display:none}
        .video-tab-content.active{display:block}
        .video-url-input-wrap{display:flex;flex-direction:column;gap:8px}
        .video-url-input-wrap input{width:100%;padding:0.75rem;background:#fff;border:2px solid var(--border);border-radius:10px;color:#333;font-size:0.9rem}
        .video-url-input-wrap input:focus{outline:none;border-color:var(--primary)}
        .video-url-preview{width:100%;aspect-ratio:16/9;background:#000;border-radius:10px;overflow:hidden;margin-top:8px;display:none}
        .video-url-preview iframe,.video-url-preview video{width:100%;height:100%;border:none}
        .video-url-preview.show{display:block}
        .video-preview-btn{padding:8px 20px;background:var(--primary);border:none;border-radius:8px;color:#000;font-weight:600;cursor:pointer;font-size:13px;font-family:'Poppins',sans-serif;align-self:flex-start}
        /* File upload for video */
        .video-file-upload{border:2px dashed var(--border);border-radius:12px;padding:1.5rem;text-align:center;cursor:pointer;transition:border-color 0.3s;background:#0b1423}
        .video-file-upload:hover{border-color:var(--primary)}
        .video-file-upload input[type="file"]{display:none}
        .video-file-upload-label{display:flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer;color:var(--text-muted)}
        .video-file-upload-label i{font-size:36px;color:var(--border)}
        .video-file-upload-label span{font-size:13px}
        .video-file-upload-label small{font-size:11px;color:var(--text-muted);opacity:0.7}
        .video-file-selected{margin-top:8px;padding:8px 12px;background:#0b1423;border-radius:8px;border:1.5px solid var(--success);color:var(--success);font-size:12px;display:none;align-items:center;gap:8px}
        .video-file-selected.show{display:flex}
        .video-remove-btn{background:var(--danger);color:#fff;border:none;border-radius:50%;width:20px;height:20px;cursor:pointer;font-size:10px;flex-shrink:0;display:flex;align-items:center;justify-content:center}

        /* ===== IMAGE UPLOAD SECTION ===== */
        .image-upload-section{grid-column:span 2;margin-top:0.5rem}
        @media(max-width:600px){.image-upload-section{grid-column:span 1}}
        .image-upload-section h3{color:var(--primary);margin-bottom:1rem;font-size:15px;display:flex;align-items:center;gap:8px}
        .image-slots-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem}
        @media(max-width:600px){.image-slots-grid{grid-template-columns:repeat(2,1fr);gap:0.6rem}}
        @media(max-width:360px){.image-slots-grid{grid-template-columns:1fr}}
        .image-slot{background:#1a2a45;border:2px dashed var(--border);border-radius:12px;overflow:hidden;transition:border-color 0.2s}
        .image-slot:hover{border-color:var(--primary)}
        .image-slot-preview{width:100%;aspect-ratio:4/3;background:#0d1829;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center;cursor:pointer}
        .image-slot-preview img{width:100%;height:100%;object-fit:cover;display:none}
        .image-slot-preview img.has-image{display:block}
        .image-slot-placeholder{display:flex;flex-direction:column;align-items:center;gap:6px;color:var(--text-muted);font-size:12px}
        .image-slot-placeholder i{font-size:28px;color:var(--border)}
        .image-slot-placeholder.hidden{display:none}
        .image-slot input[type="file"]{display:none}
        .image-slot-bottom{padding:8px 10px;display:flex;flex-direction:column;gap:6px}
        .image-slot-bottom label{font-size:11px;color:var(--text-muted);font-weight:500}
        .slot-label-input{width:100%;padding:6px 10px;background:#0d1829;border:1.5px solid var(--border);border-radius:8px;color:#fff;font-size:12px;font-family:'Poppins',sans-serif}
        .slot-label-input:focus{border-color:var(--primary);outline:none}
        .slot-num{position:absolute;top:8px;left:8px;background:var(--primary);color:#000;font-size:10px;font-weight:700;padding:2px 8px;border-radius:10px;z-index:2}
        .slot-remove{position:absolute;top:8px;right:8px;background:rgba(239,68,68,0.9);color:#fff;border:none;border-radius:50%;width:24px;height:24px;cursor:pointer;font-size:12px;display:none;align-items:center;justify-content:center;z-index:2}
        .slot-remove.visible{display:flex}
        .btn-upload{width:100%;padding:1rem;background:var(--primary);color:#000;border:none;border-radius:10px;font-weight:600;cursor:pointer;transition:all 0.3s;margin-top:1rem;font-size:1rem}
        .btn-upload:hover{background:var(--primary-dark);transform:translateY(-2px)}
        @media(max-width:600px){.btn-upload{padding:0.85rem;font-size:0.95rem}}

        /* Amenities section mobile */
        .amenities-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:0.7rem}
        @media(max-width:600px){.amenities-grid{grid-template-columns:1fr}}

        /* ===== PROPERTIES HEADER ===== */
        .properties-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;flex-wrap:wrap;gap:1rem}
        .properties-header h2{color:var(--primary);display:flex;align-items:center;gap:0.5rem}
        .search-box{display:flex;align-items:center;gap:0.5rem;background:var(--bg-secondary);padding:0.5rem 1rem;border-radius:10px;border:2px solid var(--border)}
        .search-box input{background:transparent;border:none;color:var(--text-primary);font-size:0.9rem;width:250px}
        @media(max-width:480px){.search-box input{width:140px}}
        .search-box input:focus{outline:none}
        .search-box i{color:var(--text-muted)}
        .properties-grid{display:grid;grid-template-columns:1fr;gap:2rem}
        @media(min-width:1200px){.properties-grid{grid-template-columns:repeat(2,1fr)}}

        /* ===== PROPERTY CARD ===== */
        .property-card{width:100%;background:#fff;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,0.15);padding:24px;margin:0 auto;transition:all 0.3s;border:1px solid rgba(201,162,39,0.2);position:relative;cursor:pointer}
        .property-card:hover{transform:translateY(-5px);box-shadow:0 20px 40px rgba(201,162,39,0.2);border-color:var(--primary)}
        .card-header{text-align:center;margin-bottom:16px;padding-bottom:14px;border-bottom:2px solid #eee}
        .card-header h1{color:#1a2a45;font-size:26px;font-weight:700;letter-spacing:0.5px}
        .card-header p{color:var(--primary);font-size:15px;font-weight:500;margin-top:4px}
        .card-badges{display:flex;justify-content:center;align-items:center;gap:10px;margin-bottom:14px;flex-wrap:wrap}
        .status-badge{padding:7px 18px;border-radius:30px;font-size:12px;font-weight:600;text-transform:uppercase;box-shadow:0 2px 8px rgba(0,0,0,0.15)}
        .status-badge.rent{background:#10b981;color:white}
        .status-badge.sale{background:#f59e0b;color:white}
        .status-badge.under-construction{background:#ef4444;color:white}
        .status-badge.sold-out{background:#6b7280;color:white}
        .timer-badge{padding:7px 16px;border-radius:30px;font-size:12px;font-weight:700;background:linear-gradient(135deg,#1a2a45,#0c3554);color:#fff;display:flex;align-items:center;gap:6px;box-shadow:0 2px 10px rgba(0,0,0,0.3);border:1.5px solid var(--primary)}
        .timer-badge .timer-icon{color:var(--primary);font-size:14px}
        .timer-badge .countdown{color:var(--primary);font-family:monospace;font-size:13px;letter-spacing:0.5px}
        .timer-badge.urgent{background:linear-gradient(135deg,#7f1d1d,#991b1b);border-color:#ef4444;animation:pulse 1.5s infinite}
        .timer-badge.urgent .countdown{color:#fca5a5}
        .timer-badge.available{background:linear-gradient(135deg,#064e3b,#065f46);border-color:#10b981}
        .timer-badge.available .countdown{color:#6ee7b7}
        @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.03)}100%{transform:scale(1)}}
        .date-badge{padding:6px 14px;border-radius:30px;font-size:11px;background:#1a2a45;color:white;display:flex;align-items:center;gap:5px}
        /* ===== UNIFORM 3x2 IMAGE GRID â€” all 6 images exact same size ===== */
        .img-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:18px}
        .img{position:relative;overflow:hidden;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,0.1);aspect-ratio:4/3;width:100%}
        .img img{width:100%;height:100%;object-fit:cover;transition:transform 0.3s;display:block;position:absolute;top:0;left:0}
        .img:hover img{transform:scale(1.05)}
        /* keep old grid classes harmless (used nowhere now) */
        .grid-main,.grid-bottom,.right-column{display:contents}
        .label{position:absolute;bottom:8px;left:10px;color:#000;font-size:10px;font-weight:500;background:rgba(255,255,255,0.92);padding:3px 10px;border-radius:20px;letter-spacing:0.3px;white-space:nowrap;max-width:calc(100% - 22px);overflow:hidden;text-overflow:ellipsis}
        .price-row{display:flex;align-items:center;gap:16px;margin:16px 0;flex-wrap:wrap}
        .price{background:#0c3554;color:#fff;padding:10px 24px;border-radius:40px;font-size:14px;font-weight:600;letter-spacing:0.5px;box-shadow:0 4px 12px rgba(12,53,84,0.3)}
        .title{font-size:22px;color:#1a2a45;font-weight:600;line-height:1.2}
        .location-info{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:14px;padding:10px 14px;background:#f8f9fa;border-radius:10px;border-left:3px solid var(--primary)}
        .location-item{font-size:12px;color:#333;display:flex;align-items:center;gap:5px}
        .location-item i{color:var(--primary)}
        .location-item strong{color:#0c3554}
        .info-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px;background:#f8f9fa;padding:14px;border-radius:12px}
        .info-box{font-size:12px;color:#333;line-height:1.5}
        .info-box b{display:block;color:#0c3554;font-size:13px;margin-bottom:4px}
        .features{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px}
        @media(max-width:768px){.features{grid-template-columns:repeat(2,1fr)}.img-grid{grid-template-columns:repeat(2,1fr)}.info-grid{grid-template-columns:1fr}}
        .feature{background:#f3f4f6;padding:8px 12px;border-radius:30px;font-size:11px;display:flex;align-items:center;gap:6px;color:#333;font-weight:500;box-shadow:0 2px 5px rgba(0,0,0,0.05)}
        .feature i{color:var(--primary);font-size:14px}
        .contact{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;margin-top:14px;padding-top:14px;border-top:2px solid #eee}
        .numbers{font-size:13px;color:#333;display:flex;flex-direction:column;gap:5px}
        .numbers div{margin:4px 0;display:flex;align-items:center;gap:8px;cursor:pointer;transition:color 0.3s;padding:5px 8px;border-radius:8px}
        .numbers div:hover{background:#f0f0f0}
        .numbers i{color:var(--primary);width:18px;font-size:14px}
        .numbers a{color:#333;text-decoration:none}
        .btns{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
        .btn{padding:9px 18px;border:none;border-radius:40px;color:#fff;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.3s;display:inline-flex;align-items:center;gap:5px;height:36px;white-space:nowrap}
        .btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,0.2)}
        .video-btn{background:linear-gradient(135deg,#e1306c,#c13584);color:white}
        .video-btn:hover{box-shadow:0 5px 15px rgba(225,48,108,0.4)}
        .screenshot-btn{background:linear-gradient(135deg,#3b82f6,#2563eb);color:white}
        .screenshot-btn:hover{box-shadow:0 5px 15px rgba(59,130,246,0.4)}
        .download-btn{background:#0c3554}
        .edit-btn{background:linear-gradient(135deg,#3b82f6,#2563eb);color:white;padding:9px 18px;border:none;border-radius:40px;cursor:pointer;font-size:12px;font-weight:600;transition:all 0.3s;display:inline-flex;align-items:center;gap:5px;height:36px;white-space:nowrap}
        .edit-btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(59,130,246,0.4)}
        .admin-actions{display:flex;gap:8px;margin-top:10px;width:100%;justify-content:flex-end;flex-wrap:wrap;align-items:center}
        .approve-btn,.delete-btn,.status-btn{padding:9px 16px;border:none;border-radius:40px;cursor:pointer;font-size:12px;font-weight:600;transition:all 0.3s;display:inline-flex;align-items:center;gap:5px;height:36px;white-space:nowrap}
        .approve-btn{background:#10b981;color:white}
        .approve-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(16,185,129,0.4)}
        .delete-btn{background:#ef4444;color:white}
        .delete-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(239,68,68,0.4)}
        .status-btn{background:var(--primary);color:#000}
        .status-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(201,162,39,0.4)}

        /* Modals */
        .edit-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:2000;justify-content:center;align-items:center;padding:20px}
        .edit-modal.active{display:flex}
        .edit-modal-content{background:white;border-radius:20px;max-width:600px;width:100%;max-height:90vh;overflow-y:auto;padding:30px;position:relative}
        .edit-modal-close{position:absolute;top:15px;right:15px;width:30px;height:30px;background:#f0f0f0;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer}
        .edit-form-group{margin-bottom:15px}
        .edit-form-group label{display:block;margin-bottom:5px;color:#333;font-weight:500}
        .edit-form-group input,.edit-form-group select,.edit-form-group textarea{width:100%;padding:10px;border:2px solid #ddd;border-radius:10px;font-family:'Poppins',sans-serif}
        .save-edit-btn{width:100%;padding:12px;background:var(--primary);color:#000;border:none;border-radius:10px;font-weight:600;cursor:pointer;margin-top:20px}
        .video-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:3000;justify-content:center;align-items:center;padding:20px}
        .video-modal.active{display:flex}
        .video-content{background:#fff;border-radius:20px;max-width:800px;width:100%;padding:20px;position:relative}
        .video-close{position:absolute;top:-15px;right:-15px;width:40px;height:40px;background:var(--danger);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;color:white;font-size:20px;z-index:1}
        .video-wrapper{width:100%;aspect-ratio:16/9;background:#000;border-radius:12px;overflow:hidden}
        .video-wrapper iframe,.video-wrapper video{width:100%;height:100%;border:none}
        .video-input-group{display:flex;gap:10px;margin-top:15px}
        .video-input-group input{flex:1;padding:12px;border:2px solid #ddd;border-radius:10px;font-size:14px}
        .video-input-group button{padding:12px 20px;background:var(--primary);border:none;border-radius:10px;font-weight:600;cursor:pointer}
        .screenshot-preview{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:4000;display:none;justify-content:center;align-items:center;padding:20px}
        .screenshot-preview.active{display:flex}
        .screenshot-image{max-width:90%;max-height:90%;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.5)}
        .notification-toast{position:fixed;top:100px;right:20px;z-index:9999;background:white;color:#333;padding:12px 20px;border-radius:50px;box-shadow:0 5px 20px rgba(0,0,0,0.2);display:flex;align-items:center;gap:10px;transform:translateX(400px);transition:transform 0.3s;border-left:4px solid var(--primary)}
        .notification-toast.show{transform:translateX(0)}
        .notification-toast i{color:var(--primary);font-size:18px}
        .property-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.98);z-index:2000;justify-content:center;align-items:center;padding:1rem;overflow-y:auto}
        .property-modal.active{display:flex}
        .modal-content{background:#fff;border-radius:24px;max-width:1000px;width:100%;max-height:90vh;overflow-y:auto;position:relative}
        .modal-close{position:absolute;top:1rem;right:1rem;width:40px;height:40px;background:#f0f0f0;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s;z-index:1;color:#333;font-size:20px}
        .modal-close:hover{background:var(--danger);color:#fff;transform:rotate(90deg)}
        .modal-gallery{display:grid;grid-template-columns:2fr 1fr;gap:1rem;padding:2rem;background:#f8f9fa}
        @media(max-width:768px){.modal-gallery{grid-template-columns:1fr;padding:1rem}}
        .main-image{width:100%;height:400px;border-radius:16px;overflow:hidden}
        .main-image img{width:100%;height:100%;object-fit:cover}
        .thumbnail-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:0.5rem;height:400px;overflow-y:auto}
        .thumbnail{width:100%;height:195px;border-radius:12px;overflow:hidden;cursor:pointer;opacity:0.7;transition:all 0.3s}
        .thumbnail:hover,.thumbnail.active{opacity:1;border:3px solid var(--primary)}
        .thumbnail img{width:100%;height:100%;object-fit:cover}
        .modal-details{padding:2rem;color:#333}
        .modal-title{font-size:2rem;color:#0c3554;margin-bottom:0.5rem}
        .modal-location{color:#666;margin-bottom:1rem;display:flex;align-items:center;gap:0.5rem}
        .modal-price{font-size:1.8rem;font-weight:700;color:var(--primary);margin-bottom:1.5rem}
        .modal-specs{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem;margin-bottom:2rem;padding:1.5rem;background:#f8f9fa;border-radius:16px}
        .spec-item{display:flex;align-items:center;gap:0.8rem;color:#333;font-size:16px}
        .spec-item i{color:var(--primary);font-size:20px}
        .modal-description{color:#555;line-height:1.8;margin-bottom:2rem;font-size:16px}
        .modal-amenities{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:2rem}
        .amenity-item{display:flex;align-items:center;gap:0.8rem;color:#333;padding:0.8rem;background:#f8f9fa;border-radius:10px}
        .amenity-item i{color:var(--primary)}
        .modal-actions{display:flex;gap:1rem;margin-top:2rem}
        .btn-share,.btn-download{flex:1;padding:1rem;border:none;border-radius:40px;font-weight:600;cursor:pointer;transition:all 0.3s;font-size:16px}
        .btn-share{background:transparent;border:2px solid var(--primary);color:var(--primary)}
        .btn-share:hover{background:var(--primary);color:#000}
        .btn-download{background:var(--primary);color:#000}
        .btn-download:hover{background:var(--primary-dark)}
        .no-results{text-align:center;padding:3rem 1rem;color:#fff;grid-column:1 / -1}
        .no-results i{font-size:4rem;margin-bottom:1rem;color:var(--primary)}
        .no-results h3{font-size:24px;margin-bottom:0.5rem}
        .no-results p{color:#999}

        /* Share Modal */
        .share-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:4000;justify-content:center;align-items:flex-end;padding:0}
        .share-modal.active{display:flex;animation:slideUp .3s ease}
        @keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
        .share-sheet{background:#fff;border-radius:24px 24px 0 0;width:100%;max-width:600px;margin:0 auto;padding:24px 20px 36px;position:relative}
        .share-handle{width:40px;height:4px;background:#ddd;border-radius:4px;margin:0 auto 20px}
        .share-sheet h3{text-align:center;color:#1a2a45;font-size:16px;font-weight:700;margin-bottom:6px}
        .share-prop-name{text-align:center;color:#c9a227;font-size:13px;margin-bottom:20px;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
        .share-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:20px}
        @media(min-width:400px){.share-grid{grid-template-columns:repeat(6,1fr)}}
        .share-item{display:flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer;padding:10px 6px;border-radius:14px;transition:background .2s;border:none;background:none;text-decoration:none}
        .share-item:hover{background:#f5f5f5}
        .share-icon{width:52px;height:52px;border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:20px;color:#fff;box-shadow:0 4px 12px rgba(0,0,0,0.15)}
        .share-icon.whatsapp{background:linear-gradient(135deg,#25d366,#128c7e)}
        .share-icon.facebook{background:linear-gradient(135deg,#1877f2,#0c5fd4)}
        .share-icon.instagram{background:linear-gradient(135deg,#f58529,#dd2a7b,#8134af)}
        .share-icon.tiktok{background:#010101}
        .share-icon.twitter{background:linear-gradient(135deg,#1da1f2,#0d8cd4)}
        .share-icon.telegram{background:linear-gradient(135deg,#2ca5e0,#1a7fbf)}
        .share-icon.linkedin{background:linear-gradient(135deg,#0a66c2,#084d9e)}
        .share-icon.sms{background:linear-gradient(135deg,#34c759,#28a246)}
        .share-icon.email{background:linear-gradient(135deg,#ea4335,#c5221f)}
        .share-icon.snapchat{background:#fffc00}
        .share-icon.snapchat i{color:#000}
        .share-icon.pinterest{background:linear-gradient(135deg,#e60023,#c6001e)}
        .share-icon.copy{background:linear-gradient(135deg,#636e72,#2d3436)}
        .share-label{font-size:11px;color:#444;font-weight:500;text-align:center}
        .share-divider{border:none;border-top:1px solid #eee;margin:4px 0 16px}
        .share-pdf-row{display:flex;align-items:center;justify-content:space-between;background:#f8f9fa;border-radius:14px;padding:14px 16px;margin-bottom:16px;gap:12px}
        .share-pdf-info{display:flex;align-items:center;gap:12px}
        .share-pdf-icon{width:44px;height:44px;background:linear-gradient(135deg,#ef4444,#dc2626);border-radius:12px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:20px;flex-shrink:0}
        .share-pdf-text{font-size:13px;color:#333;font-weight:600;line-height:1.4}
        .share-pdf-sub{font-size:11px;color:#888;font-weight:400}
        .share-pdf-btn{padding:9px 18px;background:linear-gradient(135deg,#c9a227,#b48a1a);border:none;border-radius:30px;color:#000;font-weight:700;font-size:12px;cursor:pointer;white-space:nowrap;flex-shrink:0}
        .share-close-btn{width:100%;padding:13px;background:#f0f0f0;border:none;border-radius:14px;font-size:14px;font-weight:600;color:#555;cursor:pointer;margin-top:4px}
        .share-close-btn:hover{background:#e0e0e0}

        /* Timer Modal */
        .timer-edit-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:3000;justify-content:center;align-items:center;padding:20px}
        .timer-edit-modal.active{display:flex}
        .timer-edit-content{background:#1a2a45;border-radius:20px;max-width:500px;width:100%;padding:30px;border:2px solid var(--primary);position:relative}
        .timer-edit-content h2{color:var(--primary);margin-bottom:20px;text-align:center}
        .timer-field{margin-bottom:15px}
        .timer-field label{display:block;margin-bottom:6px;color:#fff;font-size:13px}
        .timer-field input,.timer-field select{width:100%;padding:10px;border:2px solid var(--border);border-radius:10px;background:#0b1423;color:#fff;font-size:14px}
        .timer-field input:focus,.timer-field select:focus{outline:none;border-color:var(--primary)}
        .timer-save-btn{width:100%;padding:12px;background:var(--primary);color:#000;border:none;border-radius:10px;font-weight:700;cursor:pointer;margin-top:10px;font-size:15px}
        .timer-close-btn{position:absolute;top:15px;right:15px;background:transparent;border:none;color:#fff;font-size:20px;cursor:pointer}

        /* Section headings */
        .section-heading{color:var(--primary);margin:1rem 0 0.5rem;font-size:1rem;display:flex;align-items:center;gap:8px;grid-column:span 2}
        @media(max-width:600px){.section-heading{grid-column:span 1}}
        .section-divider{grid-column:span 2;border:none;border-top:1px solid var(--border);margin:0.5rem 0}
        @media(max-width:600px){.section-divider{grid-column:span 1}}
    </style>
</head>
<body>

<!-- Toast -->
<div id="notificationToast" class="notification-toast">
    <i class="fas fa-bell"></i>
    <span id="toastMessage">Done!</span>
    <span onclick="hideToast()" style="cursor:pointer;margin-left:4px;"><i class="fas fa-times"></i></span>
</div>

<!-- Edit Property Modal -->
<div id="editModal" class="edit-modal">
    <div class="edit-modal-content">
        <div class="edit-modal-close" onclick="closeEditModal()"><i class="fas fa-times"></i></div>
        <h2 style="color:var(--primary);margin-bottom:20px;">Edit Property</h2>
        <div id="editFormContent"></div>
    </div>
</div>

<!-- Timer Edit Modal -->
<div id="timerEditModal" class="timer-edit-modal">
    <div class="timer-edit-content">
        <button class="timer-close-btn" onclick="closeTimerModal()"><i class="fas fa-times"></i></button>
        <h2><i class="fas fa-clock"></i> Update Timer & Status</h2>
        <input type="hidden" id="timerPropertyId">
        <div class="timer-field">
            <label>Property Status</label>
            <select id="timerStatus">
                <option value="rent">For Rent</option>
                <option value="sale">For Sale</option>
                <option value="under-construction">Under Construction</option>
                <option value="sold-out">Sold Out</option>
            </select>
        </div>
        <div class="timer-field">
            <label>Available In (text)</label>
            <input type="text" id="timerAvailableText" placeholder="e.g. 3 days, 1 week">
        </div>
        <div class="timer-field">
            <label>Available Date & Time</label>
            <input type="datetime-local" id="timerAvailableDate">
        </div>
        <button class="timer-save-btn" onclick="saveTimerUpdate()"><i class="fas fa-save"></i> Save & Move to Top</button>
    </div>
</div>

<!-- Video Modal (View) -->
<div id="videoModal" class="video-modal">
    <div class="video-content">
        <div class="video-close" onclick="closeVideoModal()"><i class="fas fa-times"></i></div>
        <div class="video-wrapper" id="videoWrapper"></div>
        <div class="video-input-group">
            <input type="text" id="videoUrlInput" placeholder="Enter YouTube/Video URL...">
            <button onclick="updateVideo()">Load Video</button>
        </div>
    </div>
</div>

<!-- Screenshot Preview -->
<div id="screenshotPreview" class="screenshot-preview" onclick="this.classList.remove('active')">
    <img src="" alt="Screenshot" class="screenshot-image" id="screenshotImage">
</div>

<!-- Login Page -->
<div class="login-page" id="loginPage">
    <div class="login-container">
        <div class="header-brand">
            <img src="image-removebg-preview.png" alt="UAE Properties Logo" class="header-logo" onerror="this.style.display='none'">
            <h1>UAE Properties</h1>
            <p class="subtitle">Premium Property Portal</p>
        </div>
        <div class="login-tabs">
            <div class="login-tab active" onclick="switchLoginTab('user',this)">User Login</div>
            <div class="login-tab" onclick="switchLoginTab('admin',this)">Admin Login</div>
        </div>
        <div class="login-form">
            <div class="form-group">
                <label style="color:#000;">Username</label>
                <input type="text" id="username" placeholder="Enter username" value="user">
            </div>
            <div class="form-group">
                <label style="color:#000;">Password</label>
                <input type="password" id="password" placeholder="Enter password" value="password123">
            </div>
            <button class="login-btn" onclick="handleLogin()">Login to Dashboard</button>
        </div>
    </div>
</div>

<!-- Dashboard -->
<div class="dashboard" id="dashboard">
    <nav class="navbar">
        <div class="logo-box">
            <img src="image-removebg-preview.png" alt="UAE Properties Logo" class="logo-img" onerror="this.style.display='none'">
            <div class="logo-text">UAE Properties<span>Premium Real Estate</span></div>
        </div>
        <div class="nav-links" id="navLinks">
            <span class="nav-link active" onclick="showSection('properties',this)">Properties</span>
            <span class="nav-link" onclick="showSection('upload',this)" id="uploadLink">Upload Property</span>
            <div class="user-info" id="userInfo">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-details">
                    <div class="user-name" id="displayName">User</div>
                    <div class="user-type" id="userType">User</div>
                </div>
            </div>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </nav>

    <div class="main-container">
        <!-- Sidebar -->
        <div class="filters-sidebar">
            <div class="filters-header">
                <h3><i class="fas fa-filter"></i> Filters</h3>
                <span class="clear-filters" onclick="clearAllFilters()"><i class="fas fa-times"></i> Clear All</span>
            </div>
            <div class="filter-section">
                <h4><i class="fas fa-city"></i> City</h4>
                <select class="filter-select" id="filterCity">
                    <option value="">All Cities</option>
                    <option value="Dubai">Dubai</option>
                    <option value="Abu Dhabi">Abu Dhabi</option>
                    <option value="Sharjah">Sharjah</option>
                    <option value="Ajman">Ajman</option>
                    <option value="Ras Al Khaimah">Ras Al Khaimah</option>
                    <option value="Fujairah">Fujairah</option>
                    <option value="Umm Al Quwain">Umm Al Quwain</option>
                </select>
            </div>
            <div class="filter-section">
                <h4><i class="fas fa-map-marker-alt"></i> Area</h4>
                <select class="filter-select" id="filterArea"><option value="">All Areas</option></select>
                <div class="add-area-input">
                    <input type="text" id="newAreaInput" placeholder="Add new area..." style="flex:1;padding:0.8rem;background:#fff;border:2px solid var(--border);border-radius:10px;color:#333;">
                    <button onclick="addNewArea()" style="padding:0.8rem 1rem;background:var(--primary);border:none;border-radius:10px;color:#000;font-weight:600;cursor:pointer;"><i class="fas fa-plus"></i></button>
                </div>
                <div class="area-list" id="areaList"></div>
            </div>
            <div class="filter-section">
                <h4><i class="fas fa-map-pin"></i> Sub Area</h4>
                <select class="filter-select" id="filterSubArea"><option value="">All Sub Areas</option></select>
                <div class="add-area-input">
                    <input type="text" id="newSubAreaInput" placeholder="Add new sub area..." style="flex:1;padding:0.8rem;background:#fff;border:2px solid var(--border);border-radius:10px;color:#333;">
                    <button onclick="addNewSubArea()" style="padding:0.8rem 1rem;background:var(--primary);border:none;border-radius:10px;color:#000;font-weight:600;cursor:pointer;"><i class="fas fa-plus"></i></button>
                </div>
                <div class="area-list" id="subAreaList"></div>
            </div>
            <div class="filter-section">
                <h4><i class="fas fa-building"></i> Property Type</h4>
                <div class="filter-options" id="propertyTypeFilters"></div>
            </div>
            <div class="filter-section">
                <h4><i class="fas fa-money-bill"></i> Price Range (AED)</h4>
                <div class="price-range">
                    <input type="number" id="minPrice" placeholder="Min">
                    <input type="number" id="maxPrice" placeholder="Max">
                </div>
            </div>
            <div class="filter-section">
                <h4><i class="fas fa-home"></i> Property Status</h4>
                <div class="radio-group">
                    <label class="radio-label"><input type="radio" name="propertyStatus" value="" checked> Any</label>
                    <label class="radio-label"><input type="radio" name="propertyStatus" value="rent"> For Rent</label>
                    <label class="radio-label"><input type="radio" name="propertyStatus" value="sale"> For Sale</label>
                    <label class="radio-label"><input type="radio" name="propertyStatus" value="under-construction"> Under Construction</label>
                    <label class="radio-label"><input type="radio" name="propertyStatus" value="sold-out"> Sold Out</label>
                </div>
            </div>
            <div class="filter-section">
                <h4><i class="fas fa-clock"></i> Rental Duration</h4>
                <div class="radio-group">
                    <label class="radio-label"><input type="radio" name="rentalDuration" value="" checked> Any</label>
                    <label class="radio-label"><input type="radio" name="rentalDuration" value="hourly"> Per Hour</label>
                    <label class="radio-label"><input type="radio" name="rentalDuration" value="daily"> Per Day</label>
                    <label class="radio-label"><input type="radio" name="rentalDuration" value="monthly"> Monthly</label>
                    <label class="radio-label"><input type="radio" name="rentalDuration" value="yearly"> Yearly</label>
                </div>
            </div>
            <div class="filter-section">
                <h4><i class="fas fa-check-circle"></i> Amenities</h4>
                <div class="filter-options">
                    <label class="filter-checkbox"><input type="checkbox" value="balcony"> Balcony</label>
                    <label class="filter-checkbox"><input type="checkbox" value="attachedWashroom"> Attached Washroom</label>
                    <label class="filter-checkbox"><input type="checkbox" value="window"> Window</label>
                    <label class="filter-checkbox"><input type="checkbox" value="commonWashroom"> Common Washroom</label>
                    <label class="filter-checkbox"><input type="checkbox" value="fullClosed"> Full Closed</label>
                </div>
            </div>
            <button class="apply-filters-btn" onclick="applyFilters()"><i class="fas fa-search"></i> Apply Filters</button>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <div id="propertiesSection">
                <div class="properties-header">
                    <h2><i class="fas fa-building"></i> Available Properties</h2>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Search by title, code, location...">
                    </div>
                </div>
                <div class="properties-grid" id="propertiesGrid"></div>
            </div>

            <!-- ===== UPLOAD SECTION ===== -->
            <div id="uploadSection" style="display:none;">
                <div class="upload-form">
                    <h2><i class="fas fa-upload"></i> Upload New Property</h2>
                    <div class="form-grid">

                        <!-- Basic Info -->
                        <div class="form-group full-width">
                            <label>Property Title <span style="color:var(--primary);">*</span></label>
                            <input type="text" id="propertyTitle" placeholder="e.g., Skyline Residencies">
                        </div>
                        <div class="form-group">
                            <label>City <span style="color:var(--primary);">*</span></label>
                            <select id="propertyCity">
                                <option value="">Select City</option>
                                <option value="Dubai">Dubai</option>
                                <option value="Abu Dhabi">Abu Dhabi</option>
                                <option value="Sharjah">Sharjah</option>
                                <option value="Ajman">Ajman</option>
                                <option value="Ras Al Khaimah">Ras Al Khaimah</option>
                                <option value="Fujairah">Fujairah</option>
                                <option value="Umm Al Quwain">Umm Al Quwain</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Area <span style="color:var(--primary);">*</span></label>
                            <select id="propertyArea" onchange="loadSubAreasForUpload(); document.getElementById('propertySubAreaText').value='';"></select>
                        </div>
                        <div class="form-group">
                            <label>Sub Area</label>
                            <select id="propertySubArea" onchange="syncSubAreaText()" style="margin-bottom:6px;"><option value="">Select Sub Area</option></select>
                            <input type="text" id="propertySubAreaText" placeholder="Or type sub area manually..." style="width:100%;padding:0.75rem;background:#fff;border:2px solid var(--border);border-radius:10px;color:#333;font-size:0.9rem;margin-top:4px;">
                        </div>
                        <div class="form-group">
                            <label>Property Type <span style="color:var(--primary);">*</span></label>
                            <select id="propertyType">
                                <optgroup label="Residential">
                                    <option value="Studio Apartment">Studio Apartment</option>
                                    <option value="Bed Space">Bed Space</option>
                                    <option value="Partition">Partition</option>
                                    <option value="Room">Room</option>
                                    <option value="Hall">Hall</option>
                                </optgroup>
                                <optgroup label="Apartments (BHK)">
                                    <option value="1 BHK">1 BHK</option>
                                    <option value="2 BHK">2 BHK</option>
                                    <option value="3 BHK">3 BHK</option>
                                    <option value="4 BHK">4 BHK</option>
                                    <option value="5 BHK">5 BHK</option>
                                    <option value="6 BHK">6 BHK</option>
                                    <option value="7 BHK">7 BHK</option>
                                    <option value="8 BHK">8 BHK</option>
                                    <option value="9 BHK">9 BHK</option>
                                    <option value="10 BHK">10 BHK</option>
                                    <option value="11 BHK">11 BHK</option>
                                    <option value="12 BHK">12 BHK</option>
                                    <option value="13 BHK">13 BHK</option>
                                    <option value="14 BHK">14 BHK</option>
                                    <option value="15 BHK">15 BHK</option>
                                    <option value="16 BHK">16 BHK</option>
                                    <option value="17 BHK">17 BHK</option>
                                    <option value="18 BHK">18 BHK</option>
                                    <option value="19 BHK">19 BHK</option>
                                    <option value="20 BHK">20 BHK</option>
                                </optgroup>
                                <optgroup label="Villas">
                                    <option value="Villa">Villa</option>
                                    <option value="1 BHK Villa">1 BHK Villa</option>
                                    <option value="2 BHK Villa">2 BHK Villa</option>
                                    <option value="3 BHK Villa">3 BHK Villa</option>
                                    <option value="4 BHK Villa">4 BHK Villa</option>
                                    <option value="5 BHK Villa">5 BHK Villa</option>
                                    <option value="6 BHK Villa">6 BHK Villa</option>
                                    <option value="7 BHK Villa">7 BHK Villa</option>
                                    <option value="8 BHK Villa">8 BHK Villa</option>
                                    <option value="9 BHK Villa">9 BHK Villa</option>
                                    <option value="10 BHK Villa">10 BHK Villa</option>
                                    <option value="11 BHK Villa">11 BHK Villa</option>
                                    <option value="12 BHK Villa">12 BHK Villa</option>
                                    <option value="13 BHK Villa">13 BHK Villa</option>
                                    <option value="14 BHK Villa">14 BHK Villa</option>
                                    <option value="15 BHK Villa">15 BHK Villa</option>
                                    <option value="16 BHK Villa">16 BHK Villa</option>
                                    <option value="17 BHK Villa">17 BHK Villa</option>
                                    <option value="18 BHK Villa">18 BHK Villa</option>
                                    <option value="19 BHK Villa">19 BHK Villa</option>
                                    <option value="20 BHK Villa">20 BHK Villa</option>
                                </optgroup>
                                <optgroup label="Commercial">
                                    <option value="Warehouse">Warehouse</option>
                                    <option value="Shop">Shop</option>
                                    <option value="Office - Building">Office - Building</option>
                                    <option value="Office - Street">Office - Street</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Price (AED) <span style="color:var(--primary);">*</span></label>
                            <input type="number" id="propertyPrice" placeholder="e.g., 280000" inputmode="numeric">
                        </div>
                        <div class="form-group">
                            <label>Property Status <span style="color:var(--primary);">*</span></label>
                            <select id="propertyStatus">
                                <option value="rent">For Rent</option>
                                <option value="sale">For Sale</option>
                                <option value="under-construction">Under Construction</option>
                                <option value="sold-out">Sold Out</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Rental/Sale Type</label>
                            <select id="propertyRentalType">
                                <option value="hourly">Per Hour</option>
                                <option value="daily">Per Day</option>
                                <option value="monthly">Monthly</option>
                                <option value="yearly">Yearly</option>
                                <option value="sale">For Sale</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Size (Sq Ft) <span style="color:var(--primary);">*</span></label>
                            <input type="number" id="propertyAreaSize" placeholder="e.g., 500" inputmode="numeric">
                        </div>
                        <div class="form-group">
                            <label>Bedrooms</label>
                            <input type="number" id="propertyBedrooms" placeholder="Number of bedrooms" value="0" inputmode="numeric">
                        </div>
                        <div class="form-group">
                            <label>Bathrooms</label>
                            <input type="number" id="propertyBathrooms" placeholder="Number of bathrooms" value="1" inputmode="numeric">
                        </div>
                        <div class="form-group">
                            <label>Available In (text)</label>
                            <input type="text" id="availableIn" placeholder="e.g., 1 day, 7 days, 2 weeks">
                        </div>
                        <div class="form-group">
                            <label>Available Date & Time</label>
                            <input type="datetime-local" id="availableDate">
                        </div>
                        <div class="form-group full-width">
                            <label>Description</label>
                            <textarea id="propertyDescription" placeholder="Detailed description of the property..."></textarea>
                        </div>

                        <!-- ===== VIDEO UPLOAD SECTION ===== -->
                        <div class="video-upload-section">
                            <h3><i class="fas fa-video" style="color:var(--primary)"></i> Property Video</h3>
                            <div class="video-tabs">
                                <button type="button" class="video-tab-btn active" onclick="switchVideoTab('url', this)">
                                    <i class="fas fa-link"></i> YouTube / URL
                                </button>
                                <button type="button" class="video-tab-btn" onclick="switchVideoTab('file', this)">
                                    <i class="fas fa-file-video"></i> Upload Video File
                                </button>
                            </div>

                            <!-- URL Tab -->
                            <div class="video-tab-content active" id="videoTabUrl">
                                <div class="video-url-input-wrap">
                                    <input type="url" id="propertyVideoUrl" placeholder="https://youtube.com/watch?v=... or direct video URL">
                                    <button type="button" class="video-preview-btn" onclick="previewVideoUrl()">
                                        <i class="fas fa-play"></i> Preview
                                    </button>
                                    <div class="video-url-preview" id="videoUrlPreview"></div>
                                </div>
                            </div>

                            <!-- File Upload Tab -->
                            <div class="video-tab-content" id="videoTabFile">
                                <div class="video-file-upload" onclick="document.getElementById('videoFileInput').click()">
                                    <input type="file" id="videoFileInput" accept="video/*" onchange="handleVideoFileSelect(this)">
                                    <label class="video-file-upload-label" id="videoFileLabel">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <span>Click to upload video</span>
                                        <small>MP4, MOV, AVI, WebM supported â€¢ Max 100MB</small>
                                    </label>
                                </div>
                                <div class="video-file-selected" id="videoFileSelected">
                                    <i class="fas fa-check-circle" style="color:var(--success)"></i>
                                    <span id="videoFileName">video.mp4</span>
                                    <button type="button" class="video-remove-btn" onclick="removeVideoFile()"><i class="fas fa-times"></i></button>
                                </div>
                                <div class="video-url-preview" id="videoFilePreview" style="margin-top:10px"></div>
                            </div>
                        </div>

                        <!-- Amenities -->
                        <hr class="section-divider">
                        <h3 class="section-heading"><i class="fas fa-check-circle"></i> Amenities</h3>
                        <div class="form-group full-width">
                            <div class="amenities-grid">
                                <div class="form-group" style="margin-bottom:0">
                                    <label>Balcony</label>
                                    <select id="balcony"><option value="yes">Yes</option><option value="no" selected>No</option></select>
                                </div>
                                <div class="form-group" style="margin-bottom:0">
                                    <label>Attached Washroom</label>
                                    <select id="attachedWashroom"><option value="yes">Yes</option><option value="no" selected>No</option></select>
                                </div>
                                <div class="form-group" style="margin-bottom:0">
                                    <label>Window</label>
                                    <select id="window"><option value="yes">Yes</option><option value="no" selected>No</option></select>
                                </div>
                                <div class="form-group" style="margin-bottom:0">
                                    <label>Common Washroom</label>
                                    <select id="commonWashroom"><option value="yes">Yes</option><option value="no" selected>No</option></select>
                                </div>
                                <div class="form-group" style="margin-bottom:0">
                                    <label>Full Closed</label>
                                    <select id="fullClosed"><option value="yes">Yes</option><option value="no" selected>No</option></select>
                                </div>
                            </div>
                        </div>

                        <!-- Images -->
                        <div class="image-upload-section">
                            <h3><i class="fas fa-images"></i> Property Images & Labels (6 photos)</h3>
                            <div class="image-slots-grid">
                                <div class="image-slot">
                                    <div class="image-slot-preview" onclick="triggerUpload(1)"><span class="slot-num">1</span><div class="image-slot-placeholder" id="ph1"><i class="fas fa-camera"></i><span>Click to upload</span></div><img id="prev1" alt=""><button class="slot-remove" id="rm1" onclick="removeImage(event,1)"><i class="fas fa-times"></i></button></div>
                                    <input type="file" id="img1" accept="image/*" onchange="previewImage(1)">
                                    <div class="image-slot-bottom"><label>Room Label</label><input class="slot-label-input" id="lbl1" type="text" placeholder="e.g. Balcony" value="Balcony"></div>
                                </div>
                                <div class="image-slot">
                                    <div class="image-slot-preview" onclick="triggerUpload(2)"><span class="slot-num">2</span><div class="image-slot-placeholder" id="ph2"><i class="fas fa-camera"></i><span>Click to upload</span></div><img id="prev2" alt=""><button class="slot-remove" id="rm2" onclick="removeImage(event,2)"><i class="fas fa-times"></i></button></div>
                                    <input type="file" id="img2" accept="image/*" onchange="previewImage(2)">
                                    <div class="image-slot-bottom"><label>Room Label</label><input class="slot-label-input" id="lbl2" type="text" placeholder="e.g. Master Bedroom" value="Master Bedroom"></div>
                                </div>
                                <div class="image-slot">
                                    <div class="image-slot-preview" onclick="triggerUpload(3)"><span class="slot-num">3</span><div class="image-slot-placeholder" id="ph3"><i class="fas fa-camera"></i><span>Click to upload</span></div><img id="prev3" alt=""><button class="slot-remove" id="rm3" onclick="removeImage(event,3)"><i class="fas fa-times"></i></button></div>
                                    <input type="file" id="img3" accept="image/*" onchange="previewImage(3)">
                                    <div class="image-slot-bottom"><label>Room Label</label><input class="slot-label-input" id="lbl3" type="text" placeholder="e.g. Kitchen" value="Kitchen"></div>
                                </div>
                                <div class="image-slot">
                                    <div class="image-slot-preview" onclick="triggerUpload(4)"><span class="slot-num">4</span><div class="image-slot-placeholder" id="ph4"><i class="fas fa-camera"></i><span>Click to upload</span></div><img id="prev4" alt=""><button class="slot-remove" id="rm4" onclick="removeImage(event,4)"><i class="fas fa-times"></i></button></div>
                                    <input type="file" id="img4" accept="image/*" onchange="previewImage(4)">
                                    <div class="image-slot-bottom"><label>Room Label</label><input class="slot-label-input" id="lbl4" type="text" placeholder="e.g. Living Room" value="Living Room"></div>
                                </div>
                                <div class="image-slot">
                                    <div class="image-slot-preview" onclick="triggerUpload(5)"><span class="slot-num">5</span><div class="image-slot-placeholder" id="ph5"><i class="fas fa-camera"></i><span>Click to upload</span></div><img id="prev5" alt=""><button class="slot-remove" id="rm5" onclick="removeImage(event,5)"><i class="fas fa-times"></i></button></div>
                                    <input type="file" id="img5" accept="image/*" onchange="previewImage(5)">
                                    <div class="image-slot-bottom"><label>Room Label</label><input class="slot-label-input" id="lbl5" type="text" placeholder="e.g. Bathroom" value="Bathroom"></div>
                                </div>
                                <div class="image-slot">
                                    <div class="image-slot-preview" onclick="triggerUpload(6)"><span class="slot-num">6</span><div class="image-slot-placeholder" id="ph6"><i class="fas fa-camera"></i><span>Click to upload</span></div><img id="prev6" alt=""><button class="slot-remove" id="rm6" onclick="removeImage(event,6)"><i class="fas fa-times"></i></button></div>
                                    <input type="file" id="img6" accept="image/*" onchange="previewImage(6)">
                                    <div class="image-slot-bottom"><label>Room Label</label><input class="slot-label-input" id="lbl6" type="text" placeholder="e.g. View" value="View"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Info -->
                        <hr class="section-divider">
                        <h3 class="section-heading"><i class="fas fa-phone"></i> Contact Information</h3>
                        <div class="form-group">
                            <label>WhatsApp Number</label>
                            <input type="tel" id="whatsappNumber" placeholder="+971 50 123 4567" value="+971 50 123 4567" inputmode="tel">
                        </div>
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" id="phoneNumber" placeholder="+971 4 987 6543" value="+971 4 987 6543" inputmode="tel">
                        </div>
                        <div class="form-group">
                            <label>Profile Code</label>
                            <input type="text" id="profileCode" readonly placeholder="Auto-generated" style="background:#e9ecef;cursor:not-allowed;">
                        </div>
                        <div class="form-group">
                            <label>Location Link (Google Maps)</label>
                            <input type="url" id="locationLink" placeholder="https://maps.google.com" value="https://maps.google.com">
                        </div>

                    </div><!-- end form-grid -->
                    <button class="btn-upload" onclick="uploadProperty()">
                        <i class="fas fa-upload"></i> Upload Property
                    </button>
                </div>
            </div>
            <!-- end uploadSection -->

        </div><!-- end content-area -->
    </div><!-- end main-container -->
</div><!-- end dashboard -->

<!-- Property Details Modal -->
<div class="property-modal" id="propertyModal">
    <div class="modal-content">
        <div class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></div>
        <div class="modal-gallery" id="modalGallery"></div>
        <div class="modal-details" id="modalDetails"></div>
    </div>
</div>

<!-- Share Modal -->
<div class="share-modal" id="shareModal" onclick="if(event.target===this)closeShareModal()">
    <div class="share-sheet">
        <div class="share-handle"></div>
        <h3><i class="fas fa-share-alt" style="color:#c9a227;margin-right:6px"></i> Share Property</h3>
        <div class="share-prop-name" id="sharePropName">Property</div>
        <div class="share-pdf-row">
            <div class="share-pdf-info">
                <div class="share-pdf-icon"><i class="fas fa-file-pdf"></i></div>
                <div>
                    <div class="share-pdf-text">Property Images PDF</div>
                    <div class="share-pdf-sub" id="sharePdfStatus">Sari images ek PDF mein</div>
                </div>
            </div>
            <button class="share-pdf-btn" id="sharePdfBtn" onclick="shareDownloadPDF()"><i class="fas fa-download"></i> Download</button>
        </div>
        <hr class="share-divider">
        <div class="share-grid" id="shareGrid"></div>
        <button class="share-close-btn" onclick="closeShareModal()">Cancel</button>
    </div>
</div>

<script>
// ===== DATA =====
const defaultCityAreas = {
    'Dubai':['Downtown Dubai','Palm Jumeirah','Dubai Marina','JLT','Business Bay','Arabian Ranches','Jumeirah','Deira','Bur Dubai','Al Barsha'],
    'Abu Dhabi':['Corniche','Al Reem Island','Yas Island','Saadiyat Island','Khalifa City','Al Raha Beach','Al Bateen'],
    'Sharjah':['Al Majaz','Al Nahda','Al Taawun','Al Khan','Al Qasimia'],
    'Ajman':['Al Nuaimia','Al Rashidiya','Al Jurf','Al Mowaihat'],
    'Ras Al Khaimah':['Al Hamra Village','Al Marjan Island','Mina Al Arab'],
    'Fujairah':['Al Faseel','Al Reef','Al Maktoum'],
    'Umm Al Quwain':['Al Salamah','Al Raas','Al Aahad']
};
const defaultSubAreas = {
    'Downtown Dubai':['Burj Khalifa','The Address','South Ridge','The Lofts'],
    'Palm Jumeirah':['Atlantis','The Palm Tower','Shoreline','Frond Villas'],
    'Dubai Marina':['Marina Walk','JBR','Marina Towers'],
    'JLT':['Cluster A','Cluster B','Cluster C','Cluster D'],
    'Business Bay':['Executive Towers','Bay Avenue','Marquise Square']
};
let customAreas = JSON.parse(localStorage.getItem('customAreas')) || JSON.parse(JSON.stringify(defaultCityAreas));
let customSubAreas = JSON.parse(localStorage.getItem('customSubAreas')) || JSON.parse(JSON.stringify(defaultSubAreas));
const propertyTypes = [
    'Studio Apartment','Bed Space','Partition','Room','Hall',
    '1 BHK','2 BHK','3 BHK','4 BHK','5 BHK','6 BHK','7 BHK','8 BHK','9 BHK','10 BHK',
    '11 BHK','12 BHK','13 BHK','14 BHK','15 BHK','16 BHK','17 BHK','18 BHK','19 BHK','20 BHK',
    'Villa',
    '1 BHK Villa','2 BHK Villa','3 BHK Villa','4 BHK Villa','5 BHK Villa','6 BHK Villa','7 BHK Villa','8 BHK Villa','9 BHK Villa','10 BHK Villa',
    '11 BHK Villa','12 BHK Villa','13 BHK Villa','14 BHK Villa','15 BHK Villa','16 BHK Villa','17 BHK Villa','18 BHK Villa','19 BHK Villa','20 BHK Villa',
    'Warehouse','Shop','Office - Building','Office - Street'
];
const validUser = {username:'user',password:'password123'};
const validAdmin = {username:'admin',password:'admin123'};
let currentUser = null;
const DATA_VERSION = 'v5';
if(localStorage.getItem('dataVersion') !== DATA_VERSION){
    localStorage.removeItem('properties');
    localStorage.setItem('dataVersion', DATA_VERSION);
}
let properties = JSON.parse(localStorage.getItem('properties')) || [];

// Sample data
if(properties.length===0){
    const today=new Date();
    const in1day=new Date(today); in1day.setDate(in1day.getDate()+1);
    const in7days=new Date(today); in7days.setDate(in7days.getDate()+7);
    const in3days=new Date(today); in3days.setDate(in3days.getDate()+3);
    const day0=new Date(today);
    const day1=new Date(today); day1.setDate(day1.getDate()-1);
    const day2=new Date(today); day2.setDate(day2.getDate()-2);
    properties=[
        {id:1,profileCode:'561',title:'Skyline Residencies',city:'Dubai',area:'Dubai Marina',subArea:'Marina Walk',type:'Studio Apartment',price:280000,propertyStatus:'rent',rentalType:'monthly',bedrooms:0,bathrooms:1,areaSize:500,description:'Beautiful studio in prime location with stunning marina views. Modern furnishings, high-speed internet, gym and pool access included.',amenities:{balcony:'yes',attachedWashroom:'yes',window:'yes',commonWashroom:'no',fullClosed:'yes'},imageLabels:{main:'Balcony',second:'Master Bedroom',third:'Kitchen',fourth:'Living Room',fifth:'Bathroom',sixth:'View'},vacancy:3,images:['https://images.unsplash.com/photo-1501183638710-841dd1904471?w=800','https://images.unsplash.com/photo-1554995207-c18c203602cb?w=800','https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800','https://images.unsplash.com/photo-1560448075-bb4caa6c0c39?w=800','https://images.unsplash.com/photo-1560184897-ae75f418493e?w=800','https://images.unsplash.com/photo-1560185009-5bf9f2849488?w=800'],contact:{whatsapp:'+971 50 123 4567',phone:'+971 4 987 6543'},locationLink:'https://maps.google.com',videoUrl:'https://www.youtube.com/embed/dQw4w9WgXcQ',userId:'user',status:'approved',createdAt:day2.toISOString(),availableFrom:in1day.toISOString(),availableIn:'1 day',timerUpdatedAt:day2.toISOString()},
        {id:2,profileCode:'562',title:'Luxury Villa with Pool',city:'Dubai',area:'Palm Jumeirah',subArea:'Shoreline',type:'5 BHK Villa',price:8500000,propertyStatus:'sale',rentalType:'sale',bedrooms:5,bathrooms:7,areaSize:5000,description:'Luxury villa with private pool and beach access. Stunning views of the Arabian Gulf. Smart home technology throughout.',amenities:{balcony:'yes',attachedWashroom:'yes',window:'yes',commonWashroom:'no',fullClosed:'yes'},imageLabels:{main:'Balcony',second:'Master Bedroom',third:'Kitchen',fourth:'Pool',fifth:'Garden',sixth:'View'},vacancy:1,images:['https://images.unsplash.com/photo-1613977257363-707ba9348227?w=800','https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=800','https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=800','https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=800','https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=800','https://images.unsplash.com/photo-1600566753086-00f18fb6b3ea?w=800'],contact:{whatsapp:'+971 50 987 6543',phone:'+971 4 123 4567'},locationLink:'https://maps.google.com',videoUrl:'https://www.youtube.com/embed/3AtDnEC4zak',userId:'user',status:'approved',createdAt:day1.toISOString(),availableFrom:in7days.toISOString(),availableIn:'7 days',timerUpdatedAt:day1.toISOString()},
        {id:3,profileCode:'563',title:'Modern 2BHK Near Mall',city:'Abu Dhabi',area:'Al Reem Island',subArea:'',type:'2 BHK',price:95000,propertyStatus:'under-construction',rentalType:'yearly',bedrooms:2,bathrooms:2,areaSize:1200,description:'Modern 2 BHK apartment under construction. Expected handover soon.',amenities:{balcony:'yes',attachedWashroom:'yes',window:'yes',commonWashroom:'no',fullClosed:'no'},imageLabels:{main:'Living Room',second:'Bedroom 1',third:'Kitchen',fourth:'Bedroom 2',fifth:'Bathroom',sixth:'View'},vacancy:5,images:['https://images.unsplash.com/photo-1493809842364-78817add7ffb?w=800','https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=800','https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=800','https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=800','https://images.unsplash.com/photo-1552321554-5fefe8c9ef14?w=800','https://images.unsplash.com/photo-1560185007-c5ca9d2c014d?w=800'],contact:{whatsapp:'+971 55 456 7890',phone:'+971 2 345 6789'},locationLink:'https://maps.google.com',videoUrl:'https://www.youtube.com/embed/ScMzIvxBSi4',userId:'user',status:'approved',createdAt:day0.toISOString(),availableFrom:in3days.toISOString(),availableIn:'3 days',timerUpdatedAt:day0.toISOString()}
    ];
    localStorage.setItem('properties',JSON.stringify(properties));
}

// ===== VIDEO UPLOAD FUNCTIONS =====
let _uploadedVideoBlob = null;
let _uploadedVideoDataUrl = null;

function switchVideoTab(tab, btn){
    document.querySelectorAll('.video-tab-btn').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('.video-tab-content').forEach(c=>c.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('videoTab'+tab.charAt(0).toUpperCase()+tab.slice(1)).classList.add('active');
}

function previewVideoUrl(){
    const url = document.getElementById('propertyVideoUrl').value.trim();
    const preview = document.getElementById('videoUrlPreview');
    preview.innerHTML = '';
    preview.classList.remove('show');
    if(!url) return;
    const embedUrl = getYouTubeEmbedUrl(url);
    if(embedUrl){
        preview.innerHTML = `<iframe src="${embedUrl}" allowfullscreen frameborder="0" allow="autoplay; encrypted-media"></iframe>`;
        preview.classList.add('show');
    } else if(/\.(mp4|webm|ogg|mov)$/i.test(url)){
        preview.innerHTML = `<video src="${url}" controls></video>`;
        preview.classList.add('show');
    } else {
        showToast('Invalid video URL. Use YouTube link or direct .mp4/.webm URL');
    }
}

function handleVideoFileSelect(input){
    const file = input.files[0];
    if(!file) return;
    if(file.size > 100 * 1024 * 1024){
        showToast('Video too large! Max 100MB allowed.');
        input.value = '';
        return;
    }
    const selectedEl = document.getElementById('videoFileSelected');
    document.getElementById('videoFileName').textContent = file.name + ' (' + (file.size/(1024*1024)).toFixed(1) + 'MB)';
    selectedEl.classList.add('show');

    const preview = document.getElementById('videoFilePreview');
    const reader = new FileReader();
    reader.onload = e => {
        _uploadedVideoDataUrl = e.target.result;
        preview.innerHTML = `<video src="${e.target.result}" controls></video>`;
        preview.classList.add('show');
    };
    reader.readAsDataURL(file);
    showToast('Video selected: ' + file.name);
}

function removeVideoFile(){
    document.getElementById('videoFileInput').value = '';
    document.getElementById('videoFileSelected').classList.remove('show');
    document.getElementById('videoFilePreview').classList.remove('show');
    document.getElementById('videoFilePreview').innerHTML = '';
    _uploadedVideoDataUrl = null;
    showToast('Video removed');
}

function getFinalVideoUrl(){
    // Check which tab is active
    const urlTab = document.getElementById('videoTabUrl');
    const fileTab = document.getElementById('videoTabFile');
    if(urlTab.classList.contains('active')){
        return document.getElementById('propertyVideoUrl').value.trim();
    } else {
        // File upload - return data URL (stored locally)
        return _uploadedVideoDataUrl || '';
    }
}

// ===== TOAST =====
function showToast(msg){
    const t=document.getElementById('notificationToast');
    document.getElementById('toastMessage').textContent=msg;
    t.classList.add('show');
    setTimeout(()=>t.classList.remove('show'),3000);
}
function hideToast(){document.getElementById('notificationToast').classList.remove('show')}

// ===== LOGIN =====
function switchLoginTab(type,el){
    document.querySelectorAll('.login-tab').forEach(t=>t.classList.remove('active'));
    el.classList.add('active');
    if(type==='admin'){
        document.getElementById('username').value='admin';
        document.getElementById('password').value='admin123';
    } else {
        document.getElementById('username').value='user';
        document.getElementById('password').value='password123';
    }
}

function handleLogin(){
    const u=document.getElementById('username').value;
    const p=document.getElementById('password').value;
    if(!u||!p){alert('Please enter username and password');return;}
    const type=document.querySelector('.login-tab.active').textContent.includes('Admin')?'admin':'user';
    if(type==='admin'&&u===validAdmin.username&&p===validAdmin.password){
        currentUser={username:'admin',type:'admin'};
    }else if(type==='user'&&u===validUser.username&&p===validUser.password){
        currentUser={username:'user',type:'user'};
    }else{alert('Invalid credentials');return;}
    document.getElementById('loginPage').style.display='none';
    document.getElementById('dashboard').classList.add('active');
    document.getElementById('displayName').textContent=currentUser.username;
    document.getElementById('userType').textContent=currentUser.type==='admin'?'Administrator':'Property User';
    document.getElementById('userAvatar').textContent=currentUser.username.charAt(0).toUpperCase();
    document.getElementById('uploadLink').style.display=currentUser.type==='user'?'block':'none';
    document.getElementById('profileCode').value=Math.floor(560+Math.random()*100);
    populateFilters();
    loadAreas();
    populateAreaDropdowns();
    loadProperties();
    startCountdownTicker();
    showToast('Welcome back, '+currentUser.username+'!');
}

function logout(){
    currentUser=null;
    if(countdownInterval) clearInterval(countdownInterval);
    document.getElementById('loginPage').style.display='flex';
    document.getElementById('dashboard').classList.remove('active');
}

function showSection(section,el){
    document.querySelectorAll('.nav-link').forEach(l=>l.classList.remove('active'));
    if(el) el.classList.add('active');
    if(section==='properties'){
        document.getElementById('propertiesSection').style.display='block';
        document.getElementById('uploadSection').style.display='none';
        loadProperties();
    }else{
        if(!currentUser||currentUser.type!=='user'){alert('Only users can upload properties');return;}
        document.getElementById('propertiesSection').style.display='none';
        document.getElementById('uploadSection').style.display='block';
        loadAreasForUpload();
    }
}

// ===== AREA MANAGEMENT =====
function loadAreas(){
    let city=document.getElementById('filterCity').value;
    let list=document.getElementById('areaList');
    const sel=document.getElementById('filterArea');
    sel.innerHTML='<option value="">All Areas</option>';
    if(!city){list.innerHTML='<p style="color:var(--text-muted);padding:8px;">Select a city first</p>';return;}
    let areas=customAreas[city]||[];
    areas.forEach(a=>{sel.innerHTML+=`<option value="${a}">${a}</option>`});
    list.innerHTML=areas.map(a=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:0.5rem;border-bottom:1px solid var(--border);color:var(--text-secondary)"><span>${a}</span><button onclick="removeArea('${a}')" style="background:var(--danger);color:#fff;border:none;border-radius:5px;width:25px;height:25px;cursor:pointer"><i class="fas fa-times"></i></button></div>`).join('');
    loadSubAreas();
}
function loadSubAreas(){
    let area=document.getElementById('filterArea').value;
    let list=document.getElementById('subAreaList');
    const sel=document.getElementById('filterSubArea');
    sel.innerHTML='<option value="">All Sub Areas</option>';
    if(!area){list.innerHTML='<p style="color:var(--text-muted);padding:8px;">Select an area first</p>';return;}
    let sub=customSubAreas[area]||[];
    sub.forEach(s=>{sel.innerHTML+=`<option value="${s}">${s}</option>`});
    list.innerHTML=sub.map(s=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:0.5rem;border-bottom:1px solid var(--border);color:var(--text-secondary)"><span>${s}</span><button onclick="removeSubArea('${s}')" style="background:var(--danger);color:#fff;border:none;border-radius:5px;width:25px;height:25px;cursor:pointer"><i class="fas fa-times"></i></button></div>`).join('');
}
function addNewArea(){
    let city=document.getElementById('filterCity').value;
    let newArea=document.getElementById('newAreaInput').value.trim();
    if(!city||!newArea)return alert('Select city and enter area name');
    if(!customAreas[city])customAreas[city]=[];
    if(customAreas[city].includes(newArea))return alert('Area already exists');
    customAreas[city].push(newArea);
    localStorage.setItem('customAreas',JSON.stringify(customAreas));
    document.getElementById('newAreaInput').value='';
    loadAreas(); showToast('Area added: '+newArea);
}
function removeArea(area){
    let city=document.getElementById('filterCity').value;
    if(confirm(`Remove "${area}"?`)){
        customAreas[city]=customAreas[city].filter(a=>a!==area);
        localStorage.setItem('customAreas',JSON.stringify(customAreas));
        loadAreas(); showToast('Area removed');
    }
}
function addNewSubArea(){
    let area=document.getElementById('filterArea').value;
    let newSub=document.getElementById('newSubAreaInput').value.trim();
    if(!area||!newSub)return alert('Select area and enter sub area name');
    if(!customSubAreas[area])customSubAreas[area]=[];
    if(customSubAreas[area].includes(newSub))return alert('Sub area already exists');
    customSubAreas[area].push(newSub);
    localStorage.setItem('customSubAreas',JSON.stringify(customSubAreas));
    document.getElementById('newSubAreaInput').value='';
    loadSubAreas(); showToast('Sub Area added: '+newSub);
}
function removeSubArea(sub){
    let area=document.getElementById('filterArea').value;
    if(confirm(`Remove "${sub}"?`)){
        customSubAreas[area]=customSubAreas[area].filter(s=>s!==sub);
        localStorage.setItem('customSubAreas',JSON.stringify(customSubAreas));
        loadSubAreas(); showToast('Sub Area removed');
    }
}
function loadAreasForUpload(){
    let city=document.getElementById('propertyCity').value;
    let sel=document.getElementById('propertyArea');
    let subSel=document.getElementById('propertySubArea');
    if(!city){
        sel.innerHTML='<option value="">Select Area</option>';
        subSel.innerHTML='<option value="">Select Sub Area</option>';
        return;
    }
    let areas=customAreas[city]||[];
    sel.innerHTML='<option value="">Select Area</option>'+areas.map(a=>`<option value="${a}">${a}</option>`).join('');
    subSel.innerHTML='<option value="">Select Sub Area</option>';
}
function loadSubAreasForUpload(){
    let area=document.getElementById('propertyArea').value;
    let sel=document.getElementById('propertySubArea');
    if(!area){sel.innerHTML='<option value="">Select Sub Area</option>';return;}
    let sub=customSubAreas[area]||[];
    sel.innerHTML='<option value="">Select Sub Area</option>'+sub.map(s=>`<option value="${s}">${s}</option>`).join('');
}
function syncSubAreaText(){
    const sel=document.getElementById('propertySubArea');
    const txt=document.getElementById('propertySubAreaText');
    if(sel.value) txt.value=sel.value;
}
function populateAreaDropdowns(){
    document.getElementById('filterCity').addEventListener('change',()=>loadAreas());
    document.getElementById('filterArea').addEventListener('change',()=>loadSubAreas());
    document.getElementById('propertyCity').addEventListener('change',()=>{
        loadAreasForUpload();
        const t=document.getElementById('propertySubAreaText');
        if(t) t.value='';
    });
    document.getElementById('propertyArea').addEventListener('change',()=>{
        loadSubAreasForUpload();
        const t=document.getElementById('propertySubAreaText');
        if(t) t.value='';
    });
}
function populateFilters(){
    document.getElementById('propertyTypeFilters').innerHTML=propertyTypes.map(t=>`<label class="filter-checkbox"><input type="checkbox" value="${t}"> ${t}</label>`).join('');
}

// ===== IMAGE UPLOAD =====
function triggerUpload(n){document.getElementById('img'+n).click()}
function previewImage(n){
    const file=document.getElementById('img'+n).files[0];
    if(!file)return;
    const r=new FileReader();
    r.onload=e=>{
        const img=document.getElementById('prev'+n);
        img.src=e.target.result;
        img.classList.add('has-image');
        document.getElementById('ph'+n).classList.add('hidden');
        document.getElementById('rm'+n).classList.add('visible');
    };
    r.readAsDataURL(file);
}
function removeImage(e,n){
    if(e)e.stopPropagation();
    const img=document.getElementById('prev'+n);
    if(img){img.src='';img.classList.remove('has-image');}
    document.getElementById('ph'+n).classList.remove('hidden');
    document.getElementById('rm'+n).classList.remove('visible');
    document.getElementById('img'+n).value='';
}
function getUploadedImages(){
    const imgs=[];
    for(let i=1;i<=6;i++){
        const el=document.getElementById('prev'+i);
        imgs.push(el&&el.src&&el.src!==window.location.href?el.src:'');
    }
    return imgs;
}
function getImageLabels(){
    return{
        main:document.getElementById('lbl1')?.value||'Balcony',
        second:document.getElementById('lbl2')?.value||'Master Bedroom',
        third:document.getElementById('lbl3')?.value||'Kitchen',
        fourth:document.getElementById('lbl4')?.value||'Living Room',
        fifth:document.getElementById('lbl5')?.value||'Bathroom',
        sixth:document.getElementById('lbl6')?.value||'View'
    };
}

// ===== UPLOAD PROPERTY =====
function uploadProperty(){
    if(!currentUser||currentUser.type!=='user'){alert('Please login as user');return;}
    const imageUrls=getUploadedImages();
    const labels=getImageLabels();
    const availDate=document.getElementById('availableDate').value;
    const finalVideoUrl = getFinalVideoUrl();
    const newProperty={
        id:Date.now(),
        profileCode:document.getElementById('profileCode')?.value||Math.floor(560+Math.random()*100),
        title:document.getElementById('propertyTitle').value,
        city:document.getElementById('propertyCity').value,
        area:document.getElementById('propertyArea').value,
        subArea:document.getElementById('propertySubAreaText')?.value||document.getElementById('propertySubArea')?.value||'',
        type:document.getElementById('propertyType').value,
        price:parseFloat(document.getElementById('propertyPrice').value),
        propertyStatus:document.getElementById('propertyStatus')?.value||'rent',
        rentalType:document.getElementById('propertyRentalType').value,
        bedrooms:parseInt(document.getElementById('propertyBedrooms').value)||0,
        bathrooms:parseInt(document.getElementById('propertyBathrooms').value)||1,
        areaSize:parseFloat(document.getElementById('propertyAreaSize').value)||0,
        description:document.getElementById('propertyDescription').value,
        amenities:{balcony:document.getElementById('balcony').value,attachedWashroom:document.getElementById('attachedWashroom').value,window:document.getElementById('window').value,commonWashroom:document.getElementById('commonWashroom').value,fullClosed:document.getElementById('fullClosed').value},
        imageLabels:labels,
        vacancy:3,
        images:imageUrls,
        contact:{whatsapp:document.getElementById('whatsappNumber').value||'+971 50 123 4567',phone:document.getElementById('phoneNumber').value||'+971 4 987 6543'},
        locationLink:document.getElementById('locationLink')?.value||'https://maps.google.com',
        videoUrl:finalVideoUrl,
        availableIn:document.getElementById('availableIn')?.value||'',
        availableFrom:availDate?new Date(availDate).toISOString():'',
        status:'pending',
        userId:currentUser.username,
        createdAt:new Date().toISOString(),
        timerUpdatedAt:new Date().toISOString()
    };
    if(!newProperty.title||!newProperty.city||!newProperty.area||!newProperty.type||!newProperty.price){alert('Please fill all required fields');return;}
    properties.push(newProperty);
    localStorage.setItem('properties',JSON.stringify(properties));
    // Reset video fields
    _uploadedVideoDataUrl = null;
    document.getElementById('videoFileInput').value = '';
    document.getElementById('videoFileSelected').classList.remove('show');
    document.getElementById('videoFilePreview').classList.remove('show');
    document.getElementById('videoFilePreview').innerHTML = '';
    document.getElementById('videoUrlPreview').classList.remove('show');
    document.getElementById('videoUrlPreview').innerHTML = '';
    document.getElementById('propertyVideoUrl').value = '';
    showToast('Property uploaded! Waiting for admin approval.');
    showSection('properties');
}

// ===== VIDEO MODAL (View) =====
let currentVideoPropertyId = null;
function extractYouTubeID(url){
    if(!url) return null;
    const patterns=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,/youtube\.com\/watch\?.*v=([^&\n?#]+)/,/youtu\.be\/([^&\n?#]+)/];
    for(let p of patterns){const m=url.match(p);if(m) return m[1];}
    if(url.includes('/embed/')){const p=url.split('/embed/');if(p.length>1){const id=p[1].split('?')[0];if(id) return id;}}
    return null;
}
function getYouTubeEmbedUrl(url){
    if(!url) return null;
    const id=extractYouTubeID(url);
    if(id) return `https://www.youtube.com/embed/${id}`;
    if(url.includes('/embed/')) return url;
    return null;
}
function openVideoModal(id,e){
    if(e)e.stopPropagation();
    const p=properties.find(p=>p.id===id);
    if(!p)return;
    currentVideoPropertyId=id;
    const wrapper=document.getElementById('videoWrapper');
    const url=p.videoUrl||'';
    wrapper.innerHTML='';
    if(!url){
        wrapper.innerHTML='<p style="color:#333;text-align:center;padding:40px;">No video available</p>';
    } else {
        const embedUrl=getYouTubeEmbedUrl(url);
        if(embedUrl){
            wrapper.innerHTML=`<iframe src="${embedUrl}" allowfullscreen frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe>`;
        } else if(url.startsWith('data:video')||/\.(mp4|webm|ogg|mov)$/i.test(url)){
            wrapper.innerHTML=`<video src="${url}" controls style="width:100%;height:100%;"></video>`;
        } else {
            wrapper.innerHTML='<p style="color:#333;text-align:center;padding:40px;">Invalid video URL</p>';
        }
    }
    document.getElementById('videoUrlInput').value=p.videoUrl||'';
    document.getElementById('videoModal').classList.add('active');
}
function closeVideoModal(){
    document.getElementById('videoModal').classList.remove('active');
    document.getElementById('videoWrapper').innerHTML='';
}
function updateVideo(){
    const newUrl=document.getElementById('videoUrlInput').value.trim();
    if(!currentVideoPropertyId) return;
    properties=properties.map(p=>{
        if(p.id===currentVideoPropertyId){p.videoUrl=newUrl;p.timerUpdatedAt=new Date().toISOString();}
        return p;
    });
    localStorage.setItem('properties',JSON.stringify(properties));
    const wrapper=document.getElementById('videoWrapper');
    wrapper.innerHTML='';
    if(!newUrl){
        wrapper.innerHTML='<p style="color:#333;text-align:center;padding:40px;">No video</p>';
    } else {
        const embedUrl=getYouTubeEmbedUrl(newUrl);
        if(embedUrl){
            wrapper.innerHTML=`<iframe src="${embedUrl}" allowfullscreen frameborder="0"></iframe>`;
        } else {
            wrapper.innerHTML=`<video src="${newUrl}" controls style="width:100%;height:100%;"></video>`;
        }
    }
    showToast('Video updated!');
    applyFilters();
}

// ===== SCREENSHOT =====
function takeScreenshot(id,e){
    if(e)e.stopPropagation();
    const card=e?e.closest('.property-card'):null;
    if(!card)return;
    if(typeof html2canvas!=='undefined'){
        html2canvas(card,{scale:1.5,backgroundColor:'#ffffff',logging:false,useCORS:true}).then(canvas=>{
            const imgData=canvas.toDataURL('image/png');
            document.getElementById('screenshotImage').src=imgData;
            document.getElementById('screenshotPreview').classList.add('active');
        }).catch(()=>showToast('Screenshot failed'));
    } else {
        showToast('Screenshot library loading...');
    }
}
function loadHtml2Canvas(){
    if(typeof html2canvas!=='undefined')return;
    const s=document.createElement('script');
    s.src='https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
    document.head.appendChild(s);
}
loadHtml2Canvas();

// ===== COUNTDOWN =====
let countdownInterval=null;
function getCountdownStr(availableFrom){
    if(!availableFrom) return null;
    const now=new Date().getTime();
    const target=new Date(availableFrom).getTime();
    const diff=target-now;
    if(diff<=0) return{str:'Available Now',urgent:false,available:true};
    const days=Math.floor(diff/(1000*60*60*24));
    const hours=Math.floor((diff%(1000*60*60*24))/(1000*60*60));
    const mins=Math.floor((diff%(1000*60*60))/(1000*60));
    const secs=Math.floor((diff%(1000*60))/1000);
    let str='';
    if(days>0)str+=days+'d ';
    str+=String(hours).padStart(2,'0')+'h '+String(mins).padStart(2,'0')+'m '+String(secs).padStart(2,'0')+'s';
    return{str,urgent:diff<(24*60*60*1000),available:false};
}
function startCountdownTicker(){
    if(countdownInterval) clearInterval(countdownInterval);
    countdownInterval=setInterval(()=>{
        document.querySelectorAll('.countdown[data-from]').forEach(el=>{
            const result=getCountdownStr(el.getAttribute('data-from'));
            if(result){
                el.textContent=result.str;
                const badge=el.closest('.timer-badge');
                if(badge){
                    badge.classList.remove('urgent','available');
                    if(result.available)badge.classList.add('available');
                    else if(result.urgent)badge.classList.add('urgent');
                }
            }
        });
    },1000);
}

// ===== TIMER MODAL =====
function openTimerModal(id,e){
    if(e)e.stopPropagation();
    const p=properties.find(p=>p.id===id);
    if(!p)return;
    document.getElementById('timerPropertyId').value=id;
    document.getElementById('timerStatus').value=p.propertyStatus||'rent';
    document.getElementById('timerAvailableText').value=p.availableIn||'';
    if(p.availableFrom){
        const d=new Date(p.availableFrom);
        document.getElementById('timerAvailableDate').value=new Date(d.getTime()-d.getTimezoneOffset()*60000).toISOString().slice(0,16);
    }else{
        document.getElementById('timerAvailableDate').value='';
    }
    document.getElementById('timerEditModal').classList.add('active');
}
function closeTimerModal(){document.getElementById('timerEditModal').classList.remove('active')}
function saveTimerUpdate(){
    const id=parseInt(document.getElementById('timerPropertyId').value);
    const nowISO=new Date().toISOString();
    properties=properties.map(p=>{
        if(p.id===id){return{...p,propertyStatus:document.getElementById('timerStatus').value,availableIn:document.getElementById('timerAvailableText').value,availableFrom:document.getElementById('timerAvailableDate').value?new Date(document.getElementById('timerAvailableDate').value).toISOString():'',timerUpdatedAt:nowISO,createdAt:nowISO};}
        return p;
    });
    localStorage.setItem('properties',JSON.stringify(properties));
    closeTimerModal();applyFilters();showToast('Timer updated!');
}

// ===== ADMIN ACTIONS =====
function approveProperty(id){
    if(!currentUser||currentUser.type!=='admin')return;
    properties=properties.map(p=>p.id===id?{...p,status:'approved'}:p);
    localStorage.setItem('properties',JSON.stringify(properties));
    applyFilters();showToast('Property approved!');
}
function changePropertyStatus(id){
    const arr=['rent','sale','under-construction','sold-out'];
    const p=properties.find(p=>p.id===id);
    const next=arr[(arr.indexOf(p.propertyStatus)+1)%4];
    const now=new Date().toISOString();
    properties=properties.map(p=>p.id===id?{...p,propertyStatus:next,timerUpdatedAt:now,createdAt:now}:p);
    localStorage.setItem('properties',JSON.stringify(properties));
    applyFilters();showToast('Status: '+next);
}
function deleteProperty(id){
    if(!currentUser||currentUser.type!=='admin')return;
    if(confirm('Delete this property?')){
        properties=properties.filter(p=>p.id!==id);
        localStorage.setItem('properties',JSON.stringify(properties));
        applyFilters();showToast('Property deleted');
    }
}
function openEditModal(id){
    const p=properties.find(p=>p.id===id);
    if(!p)return;
    document.getElementById('editFormContent').innerHTML=`
        <form onsubmit="savePropertyEdit(${id}); return false;">
            <div class="edit-form-group"><label>Title</label><input type="text" id="editTitle" value="${(p.title||'').replace(/"/g,'&quot;')}" required></div>
            <div class="edit-form-group"><label>Area</label><input type="text" id="editArea" value="${p.area||''}"></div>
            <div class="edit-form-group"><label>Sub Area</label><input type="text" id="editSubArea" value="${p.subArea||''}"></div>
            <div class="edit-form-group"><label>Price (AED)</label><input type="number" id="editPrice" value="${p.price}" required></div>
            <div class="edit-form-group"><label>Size (Sq Ft)</label><input type="number" id="editSize" value="${p.areaSize}"></div>
            <div class="edit-form-group"><label>Bedrooms</label><input type="number" id="editBedrooms" value="${p.bedrooms}"></div>
            <div class="edit-form-group"><label>Bathrooms</label><input type="number" id="editBathrooms" value="${p.bathrooms}"></div>
            <div class="edit-form-group"><label>Property Status</label>
                <select id="editStatus">
                    <option value="rent" ${p.propertyStatus==='rent'?'selected':''}>For Rent</option>
                    <option value="sale" ${p.propertyStatus==='sale'?'selected':''}>For Sale</option>
                    <option value="under-construction" ${p.propertyStatus==='under-construction'?'selected':''}>Under Construction</option>
                    <option value="sold-out" ${p.propertyStatus==='sold-out'?'selected':''}>Sold Out</option>
                </select>
            </div>
            <div class="edit-form-group"><label>Video URL</label><input type="url" id="editVideoUrl" value="${p.videoUrl||''}" placeholder="https://youtube.com/..."></div>
            <div class="edit-form-group"><label>Description</label><textarea id="editDescription" rows="3">${p.description||''}</textarea></div>
            <div class="edit-form-group"><label>WhatsApp</label><input type="text" id="editWhatsapp" value="${p.contact?.whatsapp||''}"></div>
            <div class="edit-form-group"><label>Phone</label><input type="text" id="editPhone" value="${p.contact?.phone||''}"></div>
            <div class="edit-form-group"><label>Available In</label><input type="text" id="editAvailableIn" value="${p.availableIn||''}"></div>
            <button type="submit" class="save-edit-btn">Save Changes</button>
        </form>`;
    document.getElementById('editModal').classList.add('active');
}
function savePropertyEdit(id){
    const p=properties.find(p=>p.id===id);
    if(!p)return;
    p.title=document.getElementById('editTitle').value;
    p.area=document.getElementById('editArea').value;
    p.subArea=document.getElementById('editSubArea').value;
    p.price=parseFloat(document.getElementById('editPrice').value);
    p.areaSize=parseFloat(document.getElementById('editSize').value);
    p.bedrooms=parseInt(document.getElementById('editBedrooms').value)||0;
    p.bathrooms=parseInt(document.getElementById('editBathrooms').value)||1;
    p.propertyStatus=document.getElementById('editStatus').value;
    p.videoUrl=document.getElementById('editVideoUrl').value;
    p.description=document.getElementById('editDescription').value;
    p.contact={whatsapp:document.getElementById('editWhatsapp').value,phone:document.getElementById('editPhone').value};
    p.availableIn=document.getElementById('editAvailableIn').value;
    p.timerUpdatedAt=new Date().toISOString();
    localStorage.setItem('properties',JSON.stringify(properties));
    closeEditModal();applyFilters();showToast('Property updated!');
}
function closeEditModal(){document.getElementById('editModal').classList.remove('active')}

// ===== DISPLAY =====
function getStatusText(s){return{rent:'For Rent',sale:'For Sale','under-construction':'Under Construction','sold-out':'Sold Out'}[s]||s}
function formatDate(d){
    const diff=Math.ceil((new Date()-new Date(d))/(1000*60*60*24));
    if(diff<=1)return'Today';if(diff===2)return'Yesterday';return diff+' days ago';
}

// Pagination
const PAGE_SIZE=20;
let _currentList=[],_currentPage=0,_loadingMore=false;
function sortProperties(list){
    return list.sort((a,b)=>{
        const cA=new Date(a.createdAt||0).getTime();
        const cB=new Date(b.createdAt||0).getTime();
        if(cB!==cA)return cB-cA;
        return new Date(b.timerUpdatedAt||0).getTime()-new Date(a.timerUpdatedAt||0).getTime();
    });
}
function displayProperties(list){
    const grid=document.getElementById('propertiesGrid');
    if(list.length===0){
        grid.innerHTML=`<div class="no-results"><i class="fas fa-search"></i><h3>No properties found</h3><p>Try adjusting your filters</p></div>`;
        _currentList=[];_currentPage=0;removeLoadMoreBtn();return;
    }
    _currentList=sortProperties(list);_currentPage=0;grid.innerHTML='';renderNextPage();setupInfiniteScroll();
}
function renderNextPage(){
    if(_loadingMore)return;
    const grid=document.getElementById('propertiesGrid');
    const start=_currentPage*PAGE_SIZE;
    const end=Math.min(start+PAGE_SIZE,_currentList.length);
    if(start>=_currentList.length){removeLoadMoreBtn();return;}
    _loadingMore=true;
    const slice=_currentList.slice(start,end);
    const fragment=document.createDocumentFragment();
    slice.forEach(p=>{const div=document.createElement('div');div.innerHTML=buildPropertyCardHTML(p);fragment.appendChild(div.firstElementChild);});
    grid.appendChild(fragment);_currentPage++;_loadingMore=false;updateLoadMoreBtn();
}
function updateLoadMoreBtn(){
    removeLoadMoreBtn();
    const remaining=_currentList.length-(_currentPage*PAGE_SIZE);
    if(remaining<=0)return;
    const grid=document.getElementById('propertiesGrid');
    const btn=document.createElement('div');
    btn.id='loadMoreBtn';btn.style.cssText='grid-column:1/-1;text-align:center;padding:20px';
    btn.innerHTML=`<button onclick="renderNextPage()" style="padding:12px 32px;background:var(--primary);border:none;border-radius:30px;font-weight:700;cursor:pointer;font-size:14px">Load More (${remaining} remaining)</button>`;
    grid.appendChild(btn);
}
function removeLoadMoreBtn(){const btn=document.getElementById('loadMoreBtn');if(btn)btn.remove();}
let _scrollObserver=null;
function setupInfiniteScroll(){
    if(_scrollObserver)_scrollObserver.disconnect();
    _scrollObserver=new IntersectionObserver(entries=>{if(entries[0].isIntersecting)renderNextPage();},{threshold:0.1});
    setTimeout(()=>{const btn=document.getElementById('loadMoreBtn');if(btn)_scrollObserver.observe(btn);},100);
}

function buildPropertyCardHTML(p){
    const fallback=`data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100%25' height='100%25'%3E%3Crect width='100%25' height='100%25' fill='%23f0f0f0'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' fill='%23aaa' font-family='Arial' font-size='14'%3ENo Image%3C/text%3E%3C/svg%3E`;
    const imgs=p.images||[];const lbl=p.imageLabels||{};
    const roomIcons={'Balcony':'ðŸŒ‡','Living Room':'ðŸ›‹ï¸','Master Bedroom':'ðŸ›ï¸','Kitchen':'ðŸ³','Bathroom':'ðŸš¿','View':'ðŸŒ†','Pool':'ðŸŠ','Garden':'ðŸŒ¿'};
    const imgTag=(i,label)=>`<div class="img"><img src="${imgs[i]||fallback}" loading="lazy" onerror="this.src='${fallback}'"><div class="label">${roomIcons[label]||'ðŸ“·'} ${label||'Room'}</div></div>`;
    const priceDisplay=`AED ${p.price.toLocaleString()}`;
    const rentalSuffix=p.rentalType&&p.rentalType!=='sale'?` / ${p.rentalType}`:'';
    let timerBadgeHTML='';
    if(p.availableFrom){
        const result=getCountdownStr(p.availableFrom);
        if(result){const extraClass=result.available?'available':result.urgent?'urgent':'';timerBadgeHTML=`<span class="timer-badge ${extraClass}"><i class="fas fa-clock timer-icon"></i> <span class="countdown" data-from="${p.availableFrom}">${result.str}</span></span>`;}
    }else if(p.availableIn){
        timerBadgeHTML=`<span class="timer-badge"><i class="fas fa-clock timer-icon"></i> Available in <span class="countdown">${p.availableIn}</span></span>`;
    }
    const timerEditBtn=currentUser?.type==='admin'?`<button class="status-btn" onclick="openTimerModal(${p.id},event)" title="Edit Timer"><i class="fas fa-clock"></i> Timer</button>`:'';
    const whatsappLink=p.contact?.whatsapp?`https://wa.me/${p.contact.whatsapp.replace(/\D/g,'')}`:'#';
    const phoneLink=p.contact?.phone?`tel:${p.contact.phone.replace(/\D/g,'')}`:'#';
    return`<div class="property-card" onclick="showPropertyDetails(${p.id})">
        <div class="card-header"><h1>Users Properties UAE</h1><p>Profile Code: ${p.profileCode||'â€”'}</p></div>
        <div class="card-badges">
            <span class="status-badge ${p.propertyStatus}">${getStatusText(p.propertyStatus)}</span>
            ${timerBadgeHTML}
            <span class="date-badge"><i class="fas fa-calendar-alt"></i> ${formatDate(p.createdAt)}</span>
        </div>
        <div class="img-grid">${imgTag(0,lbl.main||'Balcony')}${imgTag(1,lbl.second||'Master Bedroom')}${imgTag(2,lbl.third||'Kitchen')}${imgTag(3,lbl.fourth||'Living Room')}${imgTag(4,lbl.fifth||'Bathroom')}${imgTag(5,lbl.sixth||'View')}</div>
        <div class="price-row"><div class="price">${priceDisplay}${rentalSuffix}</div><div class="title">${p.title||''}</div></div>
        <div class="location-info">
            <div class="location-item"><i class="fas fa-city"></i><span><strong>City:</strong> ${p.city}</span></div>
            <div class="location-item"><i class="fas fa-map-marker-alt"></i><span><strong>Area:</strong> ${p.area}</span></div>
            ${p.subArea?`<div class="location-item"><i class="fas fa-map-pin"></i><span><strong>Sub Area:</strong> ${p.subArea}</span></div>`:''}
        </div>
        <div class="info-grid">
            <div class="info-box"><b>Type</b>${p.type}</div>
            <div class="info-box"><b>Size</b>${p.areaSize} Sq Ft</div>
            <div class="info-box"><b>Profile</b>${p.profileCode||'â€”'}</div>
        </div>
        <div class="features">
            ${p.amenities?.balcony==='yes'?'<div class="feature"><i class="fa fa-building"></i> Balcony</div>':''}
            ${p.amenities?.window==='yes'?'<div class="feature"><i class="fa fa-window-maximize"></i> Window</div>':''}
            ${p.bedrooms>0?`<div class="feature"><i class="fa fa-bed"></i> ${p.bedrooms} Bed</div>`:''}
            <div class="feature"><i class="fa fa-bath"></i> ${p.bathrooms} Bath</div>
        </div>
        <div class="contact">
            <div class="numbers">
                <div onclick="event.stopPropagation(); window.open('${whatsappLink}','_blank')"><i class="fab fa-whatsapp"></i> ${p.contact?.whatsapp||'â€”'}</div>
                <div onclick="event.stopPropagation(); window.location.href='${phoneLink}'"><i class="fas fa-phone"></i> ${p.contact?.phone||'â€”'}</div>
            </div>
            <div class="btns">
                <button class="btn video-btn" onclick="event.stopPropagation(); openVideoModal(${p.id},event)"><i class="fas fa-video"></i> Video</button>
                <button class="btn download-btn" onclick="event.stopPropagation(); downloadPropertyPDF(${p.id})"><i class="fas fa-download"></i> PDF</button>
                <button class="btn screenshot-btn" onclick="event.stopPropagation(); takeScreenshot(${p.id},event)"><i class="fas fa-camera"></i> Screenshot</button>
                ${currentUser?.type==='admin'?`<button class="btn edit-btn" onclick="event.stopPropagation(); openEditModal(${p.id})"><i class="fas fa-edit"></i> Edit</button>`:''}
            </div>
            ${currentUser?.type==='admin'?`<div class="admin-actions">
                ${p.status==='pending'?`<button class="approve-btn" onclick="event.stopPropagation(); approveProperty(${p.id})"><i class="fas fa-check"></i> Approve</button>`:''}
                ${timerEditBtn}
                <button class="status-btn" onclick="event.stopPropagation(); changePropertyStatus(${p.id})"><i class="fas fa-sync-alt"></i> Status</button>
                <button class="delete-btn" onclick="event.stopPropagation(); deleteProperty(${p.id})"><i class="fas fa-trash"></i> Delete</button>
            </div>`:''}
        </div>
    </div>`;
}

// ===== FILTERS =====
function applyFilters(){
    let filtered=[...properties];
    const city=document.getElementById('filterCity').value;
    const area=document.getElementById('filterArea').value;
    const subArea=document.getElementById('filterSubArea').value;
    const minPrice=parseFloat(document.getElementById('minPrice').value);
    const maxPrice=parseFloat(document.getElementById('maxPrice').value);
    const propertyStatus=document.querySelector('input[name="propertyStatus"]:checked')?.value;
    const rentalDuration=document.querySelector('input[name="rentalDuration"]:checked')?.value;
    const searchTerm=document.getElementById('searchInput').value.toLowerCase();
    if(city)filtered=filtered.filter(p=>p.city===city);
    if(area)filtered=filtered.filter(p=>p.area===area);
    if(subArea)filtered=filtered.filter(p=>p.subArea===subArea);
    if(minPrice)filtered=filtered.filter(p=>p.price>=minPrice);
    if(maxPrice)filtered=filtered.filter(p=>p.price<=maxPrice);
    if(propertyStatus)filtered=filtered.filter(p=>p.propertyStatus===propertyStatus);
    if(rentalDuration)filtered=filtered.filter(p=>p.rentalType===rentalDuration);
    const typeChecks=document.querySelectorAll('#propertyTypeFilters input:checked');
    if(typeChecks.length>0){const sel=Array.from(typeChecks).map(c=>c.value);filtered=filtered.filter(p=>sel.includes(p.type));}
    ['balcony','attachedWashroom','window','commonWashroom','fullClosed'].forEach(a=>{
        const cb=document.querySelector(`.filter-options input[value="${a}"]`);
        if(cb?.checked)filtered=filtered.filter(p=>p.amenities?.[a]==='yes');
    });
    if(searchTerm){
        filtered=filtered.filter(p=>
            (p.title||'').toLowerCase().includes(searchTerm)||
            (p.description||'').toLowerCase().includes(searchTerm)||
            (p.area||'').toLowerCase().includes(searchTerm)||
            (p.subArea||'').toLowerCase().includes(searchTerm)||
            (p.city||'').toLowerCase().includes(searchTerm)||
            (p.profileCode||'').toLowerCase().includes(searchTerm)
        );
    }
    if(!currentUser||currentUser.type!=='admin')filtered=filtered.filter(p=>p.status==='approved');
    displayProperties(filtered);
}
function loadProperties(){applyFilters();}
function clearAllFilters(){
    document.getElementById('filterCity').value='';
    document.getElementById('filterArea').innerHTML='<option value="">All Areas</option>';
    document.getElementById('filterSubArea').innerHTML='<option value="">All Sub Areas</option>';
    document.getElementById('areaList').innerHTML='';
    document.getElementById('subAreaList').innerHTML='';
    document.querySelectorAll('#propertyTypeFilters input').forEach(c=>c.checked=false);
    document.getElementById('minPrice').value='';
    document.getElementById('maxPrice').value='';
    const ps=document.querySelector('input[name="propertyStatus"][value=""]');if(ps)ps.checked=true;
    const rd=document.querySelector('input[name="rentalDuration"][value=""]');if(rd)rd.checked=true;
    document.querySelectorAll('.filter-options input[type="checkbox"]').forEach(c=>c.checked=false);
    document.getElementById('searchInput').value='';
    applyFilters();showToast('Filters cleared');
}

// ===== DETAIL MODAL =====
function showPropertyDetails(id){
    const p=properties.find(p=>p.id===id);
    if(!p)return;
    const modal=document.getElementById('propertyModal');
    const gallery=document.getElementById('modalGallery');
    const details=document.getElementById('modalDetails');
    const fallback=`data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100%25' height='100%25'%3E%3Crect width='100%25' height='100%25' fill='%23f0f0f0'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' fill='%23aaa'%3ENo Image%3C/text%3E%3C/svg%3E`;
    gallery.innerHTML=`
        <div class="main-image"><img src="${p.images[0]||fallback}" id="mainModalImage"></div>
        <div class="thumbnail-grid">${p.images.map((img,i)=>`<div class="thumbnail ${i===0?'active':''}" onclick="changeModalImage('${img||fallback}',this)"><img src="${img||fallback}"></div>`).join('')}</div>`;
    const amenities=[];
    if(p.amenities?.balcony==='yes')amenities.push('Balcony');
    if(p.amenities?.attachedWashroom==='yes')amenities.push('Attached Washroom');
    if(p.amenities?.window==='yes')amenities.push('Window');
    if(p.amenities?.commonWashroom==='yes')amenities.push('Common Washroom');
    if(p.amenities?.fullClosed==='yes')amenities.push('Full Closed');
    const whatsappLink=p.contact?.whatsapp?`https://wa.me/${p.contact.whatsapp.replace(/\D/g,'')}`:'#';
    const phoneLink=p.contact?.phone?`tel:${p.contact.phone.replace(/\D/g,'')}`:'#';
    details.innerHTML=`
        <h2 class="modal-title">${p.title||''}</h2>
        <div class="modal-location"><i class="fas fa-map-marker-alt"></i> ${p.subArea?p.subArea+', ':''}${p.area}, ${p.city} | Code: ${p.profileCode}</div>
        <div class="modal-price">AED ${p.price.toLocaleString()} ${p.rentalType&&p.rentalType!=='sale'?'/ '+p.rentalType:' (Sale)'}</div>
        <div class="modal-specs">
            <div class="spec-item"><i class="fas fa-bed"></i> ${p.bedrooms} Beds</div>
            <div class="spec-item"><i class="fas fa-bath"></i> ${p.bathrooms} Baths</div>
            <div class="spec-item"><i class="fas fa-vector-square"></i> ${p.areaSize} sq ft</div>
        </div>
        <div class="modal-description">${p.description||''}</div>
        <h3 style="color:var(--primary);margin-bottom:1rem;">Amenities</h3>
        <div class="modal-amenities">${amenities.map(a=>`<div class="amenity-item"><i class="fas fa-check-circle"></i> ${a}</div>`).join('')}</div>
        <div class="modal-actions">
            <button class="btn-share" onclick="shareProperty(${p.id})"><i class="fas fa-share-alt"></i> Share</button>
            <button class="btn-download" onclick="downloadPropertyPDF(${p.id})"><i class="fas fa-download"></i> Download PDF</button>
        </div>
        <div style="margin-top:20px;padding:15px;background:#f8f9fa;border-radius:10px;">
            <h4 style="color:var(--primary);margin-bottom:10px;">Contact</h4>
            <div style="display:flex;gap:15px;flex-wrap:wrap;">
                <a href="${whatsappLink}" target="_blank" style="text-decoration:none;color:#25d366;display:flex;align-items:center;gap:5px;"><i class="fab fa-whatsapp fa-2x"></i> ${p.contact?.whatsapp||'â€”'}</a>
                <a href="${phoneLink}" style="text-decoration:none;color:#333;display:flex;align-items:center;gap:5px;"><i class="fas fa-phone-alt fa-2x"></i> ${p.contact?.phone||'â€”'}</a>
            </div>
        </div>`;
    modal.classList.add('active');
}
function changeModalImage(src,el){
    document.getElementById('mainModalImage').src=src;
    document.querySelectorAll('.thumbnail').forEach(t=>t.classList.remove('active'));
    el.classList.add('active');
}
function closeModal(){document.getElementById('propertyModal').classList.remove('active')}

// ===== SHARE =====
let _sharePropertyId=null,_shareText='',_sharePdfBlob=null,_sharePlatforms=[];
function buildShareText(p){
    const statusMap={rent:'For Rent',sale:'For Sale','under-construction':'Under Construction','sold-out':'Sold Out'};
    const rentalMap={hourly:'Per Hour',daily:'Per Day',monthly:'Monthly',yearly:'Yearly',sale:'For Sale'};
    const amenList=[];
    if(p.amenities?.balcony==='yes')amenList.push('Balcony');
    if(p.amenities?.attachedWashroom==='yes')amenList.push('Attached Washroom');
    if(p.amenities?.window==='yes')amenList.push('Window');
    if(p.amenities?.commonWashroom==='yes')amenList.push('Common Washroom');
    if(p.amenities?.fullClosed==='yes')amenList.push('Full Closed');
    return['ðŸ¢ *USERS PROPERTIES UAE*','ðŸ“Œ Code: '+(p.profileCode||'â€”'),'','ðŸ  *'+(p.title||'')+'*','ðŸ“ '+(p.subArea?p.subArea+', ':'')+p.area+', '+p.city,'ðŸ’° AED '+(p.price||0).toLocaleString()+(p.rentalType&&p.rentalType!=='sale'?' / '+(rentalMap[p.rentalType]||p.rentalType):''),'ðŸ·ï¸ '+(statusMap[p.propertyStatus]||''),'','ðŸ“ '+(p.type||'')+' | '+(p.areaSize||'')+' Sq Ft'+(p.bedrooms>0?' | '+p.bedrooms+' Bed':'')+' | '+(p.bathrooms||'')+' Bath',amenList.length>0?'âœ¨ '+amenList.join(', '):'',p.availableIn?'â° Available In: '+p.availableIn:'','',p.description?'ðŸ“ '+p.description:'','','ðŸ“ž WA: '+(p.contact?.whatsapp||'â€”'),'ðŸ“ž Ph: '+(p.contact?.phone||'â€”'),'','â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”','ðŸŒ UAE Properties Portal'].filter(l=>l!==null&&l!==undefined&&l!=='').join('\n');
}
async function shareProperty(id){
    const p=properties.find(pr=>pr.id===id);
    if(!p)return;
    _sharePropertyId=id;_shareText=buildShareText(p);_sharePdfBlob=null;
    const enc=encodeURIComponent(_shareText);
    const subj=encodeURIComponent('Property: '+(p.title||''));
    _sharePlatforms=[
        {name:'WhatsApp',cls:'whatsapp',icon:'fab fa-whatsapp',mobile:'whatsapp://send?text='+enc,web:'https://wa.me/?text='+enc},
        {name:'Facebook',cls:'facebook',icon:'fab fa-facebook-f',web:'https://www.facebook.com/sharer/sharer.php?quote='+enc},
        {name:'Instagram',cls:'instagram',icon:'fab fa-instagram',copyOpen:true,appScheme:'instagram://app',copyMsg:'Instagram ke liye copy ho gayi!'},
        {name:'TikTok',cls:'tiktok',icon:'fab fa-tiktok',copyOpen:true,appScheme:'tiktok://',copyMsg:'TikTok ke liye copy ho gayi!'},
        {name:'Snapchat',cls:'snapchat',icon:'fab fa-snapchat-ghost',copyOpen:true,appScheme:'snapchat://',copyMsg:'Snapchat ke liye copy ho gayi!'},
        {name:'Twitter/X',cls:'twitter',icon:'fab fa-twitter',web:'https://twitter.com/intent/tweet?text='+enc},
        {name:'Telegram',cls:'telegram',icon:'fab fa-telegram-plane',web:'https://t.me/share/url?text='+enc},
        {name:'LinkedIn',cls:'linkedin',icon:'fab fa-linkedin-in',web:'https://www.linkedin.com/sharing/share-offsite/?url=https://uaeproperties.com'},
        {name:'Email',cls:'email',icon:'fas fa-envelope',isEmail:true,subj:subj,body:enc},
        {name:'SMS',cls:'sms',icon:'fas fa-sms',isSms:true,body:enc},
        {name:'Copy',cls:'copy',icon:'fas fa-copy',onlyCopy:true,copyMsg:'Details copy ho gayi!'},
    ];
    document.getElementById('sharePropName').textContent=p.title||'Property';
    document.getElementById('sharePdfStatus').textContent='PDF ban raha hai...';
    document.getElementById('sharePdfBtn').disabled=true;
    document.getElementById('sharePdfBtn').innerHTML='<i class="fas fa-spinner fa-spin"></i> Wait...';
    document.getElementById('shareGrid').innerHTML=_sharePlatforms.map((pl,i)=>`<button class="share-item" onclick="doShare(${i})"><div class="share-icon ${pl.cls}"><i class="${pl.icon}"></i></div><span class="share-label">${pl.name}</span></button>`).join('');
    document.getElementById('shareModal').classList.add('active');
    buildSharePdf(p).then(blob=>{
        _sharePdfBlob=blob;
        const cnt=p.images.filter(x=>x&&x.trim()).length;
        document.getElementById('sharePdfStatus').textContent=blob?cnt+' images ready':'Images nahi mili';
        document.getElementById('sharePdfBtn').disabled=false;
        document.getElementById('sharePdfBtn').innerHTML='<i class="fas fa-download"></i> Download PDF';
    });
}
function doShare(idx){
    const pl=_sharePlatforms[idx];if(!pl)return;
    if(pl.copyOpen){fallbackCopy(_shareText,pl.copyMsg);setTimeout(()=>tryOpenApp(pl.appScheme),600);return;}
    if(pl.onlyCopy){fallbackCopy(_shareText,pl.copyMsg);return;}
    if(pl.isEmail){window.location.href='mailto:?subject='+pl.subj+'&body='+pl.body;return;}
    if(pl.isSms){window.location.href=(/iphone|ipad|ipod/i.test(navigator.userAgent)?'sms:&body=':'sms:?body=')+pl.body;return;}
    const isMobile=/android|iphone|ipad|ipod|mobile/i.test(navigator.userAgent);
    if(isMobile&&pl.mobile){const t=setTimeout(()=>window.open(pl.web,'_blank'),1500);window.addEventListener('blur',()=>clearTimeout(t),{once:true});window.location.href=pl.mobile;}
    else window.open(pl.web,'_blank');
}
function tryOpenApp(scheme){const i=document.createElement('iframe');i.style.cssText='display:none;width:0;height:0;border:0';i.src=scheme;document.body.appendChild(i);setTimeout(()=>{if(document.body.contains(i))document.body.removeChild(i);},2000);}
function fallbackCopy(text,msg){
    if(navigator.clipboard&&navigator.clipboard.writeText){navigator.clipboard.writeText(text).then(()=>showToast(msg||'Copy ho gayi!')).catch(()=>legacyCopy(text,msg));}
    else legacyCopy(text,msg);
}
function legacyCopy(text,msg){const ta=document.createElement('textarea');ta.value=text;ta.style.cssText='position:fixed;left:-9999px;top:-9999px;opacity:0';document.body.appendChild(ta);ta.focus();ta.select();try{document.execCommand('copy');showToast(msg||'Copy ho gayi!');}catch(e){showToast('Copy nahi ho saka');}document.body.removeChild(ta);}
function shareDownloadPDF(){
    const p=properties.find(pr=>pr.id===_sharePropertyId);
    const fname=((p&&p.title||'Property').replace(/[^a-z0-9]/gi,'_'))+'_photos.pdf';
    if(!_sharePdfBlob){if(_sharePropertyId)downloadPropertyPDF(_sharePropertyId);return;}
    try{if(navigator.canShare){const f=new File([_sharePdfBlob],fname,{type:'application/pdf'});if(navigator.canShare({files:[f]})){navigator.share({title:'Property Photos',files:[f]}).then(()=>showToast('PDF share ho gayi!')).catch(()=>triggerPdfDownload(fname));return;}}}catch(e){}
    triggerPdfDownload(fname);
}
function triggerPdfDownload(fname){const url=URL.createObjectURL(_sharePdfBlob);const a=document.createElement('a');a.href=url;a.download=fname||'property_photos.pdf';document.body.appendChild(a);a.click();document.body.removeChild(a);setTimeout(()=>URL.revokeObjectURL(url),1000);showToast('PDF download ho gayi!');}
function closeShareModal(){document.getElementById('shareModal').classList.remove('active')}
async function buildSharePdf(p){
    if(!window.jspdf)return null;
    try{
        const{jsPDF}=window.jspdf;const doc=new jsPDF('p','mm','a4');
        const margin=10,contentW=190,imgH=(297-margin*3)/2;
        const allImages=[];const labels=p.imageLabels||{};const labelKeys=['main','second','third','fourth','fifth','sixth'];const labelNames=['Balcony','Master Bedroom','Kitchen','Living Room','Bathroom','View'];
        for(let i=0;i<6;i++){if(p.images[i]&&p.images[i].trim())allImages.push({url:p.images[i],label:labels[labelKeys[i]]||labelNames[i],num:i+1});}
        if(allImages.length===0)return null;
        async function loadImg(url){return new Promise(resolve=>{const img=new Image();img.crossOrigin='anonymous';img.onload=()=>{const c=document.createElement('canvas');c.width=img.naturalWidth||800;c.height=img.naturalHeight||600;c.getContext('2d').drawImage(img,0,0);resolve(c.toDataURL('image/jpeg',0.88));};img.onerror=()=>resolve(null);img.src=url;setTimeout(()=>resolve(null),8000);});}
        let imgIndex=0,pageNum=0;
        while(imgIndex<allImages.length){
            if(pageNum>0)doc.addPage();pageNum++;
            for(let slot=0;slot<2;slot++){
                if(imgIndex>=allImages.length)break;
                const item=allImages[imgIndex];const x=margin,y=margin+slot*(imgH+margin);
                doc.setFillColor(230,230,230);doc.roundedRect(x,y,contentW,imgH,2,2,'F');
                const dataUrl=await loadImg(item.url);
                if(dataUrl)doc.addImage(dataUrl,'JPEG',x,y,contentW,imgH,undefined,'FAST');
                if(item.label){const fs=9;doc.setFontSize(fs);const tw=doc.getStringUnitWidth(item.label)*fs*0.352+8;doc.setFillColor(255,255,255);doc.roundedRect(x+4,y+imgH-8,tw,6.5,2,2,'F');doc.setTextColor(20,20,20);doc.setFont('helvetica','bold');doc.text(item.label,x+8,y+imgH-3.2);}
                doc.setFillColor(26,42,69);doc.roundedRect(x+contentW-18,y+3,15,6.5,2,2,'F');doc.setFontSize(6.5);doc.setTextColor(255,255,255);doc.setFont('helvetica','normal');doc.text(item.num+'/'+allImages.length,x+contentW-10.5,y+7.5,{align:'center'});
                imgIndex++;
            }
        }
        return doc.output('blob');
    }catch(e){return null;}
}

// ===== PDF DOWNLOAD =====
async function downloadPropertyPDF(id){
    const p=properties.find(pr=>pr.id===id);if(!p)return;
    showToast('PDF ban raha hai...');
    if(!window.jspdf){showToast('PDF library load ho rahi hai...');return;}
    const{jsPDF}=window.jspdf;const doc=new jsPDF('p','mm','a4');
    const margin=10,contentW=190,imgH=(297-margin*3)/2;
    const allImages=[];const labels=p.imageLabels||{};const labelKeys=['main','second','third','fourth','fifth','sixth'];const labelNames=['Balcony','Master Bedroom','Kitchen','Living Room','Bathroom','View'];
    for(let i=0;i<6;i++){if(p.images[i]&&p.images[i].trim())allImages.push({url:p.images[i],label:labels[labelKeys[i]]||labelNames[i],num:i+1});}
    if(allImages.length===0){showToast('Koi image nahi mili!');return;}
    async function loadImageToCanvas(url){return new Promise(resolve=>{const img=new Image();img.crossOrigin='anonymous';img.onload=()=>{const c=document.createElement('canvas');c.width=img.naturalWidth||800;c.height=img.naturalHeight||600;c.getContext('2d').drawImage(img,0,0);resolve(c.toDataURL('image/jpeg',0.92));};img.onerror=()=>resolve(null);img.src=url;setTimeout(()=>resolve(null),8000);});}
    let pageNum=0,imgIndex=0;
    while(imgIndex<allImages.length){
        if(pageNum>0)doc.addPage();pageNum++;
        for(let slot=0;slot<2;slot++){
            if(imgIndex>=allImages.length)break;
            const item=allImages[imgIndex];const x=margin,y=margin+slot*(imgH+margin);
            doc.setFillColor(230,230,230);doc.roundedRect(x,y,contentW,imgH,2,2,'F');
            const dataUrl=await loadImageToCanvas(item.url);
            if(dataUrl){doc.addImage(dataUrl,'JPEG',x,y,contentW,imgH,undefined,'FAST');}
            else{doc.setFontSize(10);doc.setTextColor(150,150,150);doc.text('Image Load Nahi Hui',x+contentW/2,y+imgH/2,{align:'center',baseline:'middle'});}
            if(item.label&&item.label.trim()){const fontSize=9;doc.setFontSize(fontSize);const textW=doc.getStringUnitWidth(item.label)*fontSize*0.352;const badgeW=textW+8;doc.setFillColor(255,255,255);doc.roundedRect(x+4,y+imgH-11,badgeW,7,2,2,'F');doc.setTextColor(20,20,20);doc.setFont('helvetica','bold');doc.text(item.label,x+8,y+imgH-5.2);}
            doc.setFillColor(26,42,69);doc.roundedRect(x+contentW-18,y+3,15,6.5,2,2,'F');doc.setFontSize(6.5);doc.setTextColor(255,255,255);doc.setFont('helvetica','normal');doc.text(item.num+'/'+allImages.length,x+contentW-10.5,y+7.5,{align:'center'});
            imgIndex++;
        }
    }
    doc.save(((p.title||'Property').replace(/[^a-zA-Z0-9 ]/g,'_'))+'_photos.pdf');
    showToast('PDF ready! '+allImages.length+' images download ho gayi!');
}

// ===== SEARCH DEBOUNCE =====
let _searchDebounce=null;
document.getElementById('searchInput').addEventListener('input',function(){clearTimeout(_searchDebounce);_searchDebounce=setTimeout(applyFilters,350);});
document.getElementById('searchInput').addEventListener('keyup',function(e){if(e.key==='Enter'){clearTimeout(_searchDebounce);applyFilters();}});

// ===== SAFE STORAGE =====
const _origSetItem=localStorage.setItem.bind(localStorage);
localStorage.setItem=function(key,val){
    if(key==='properties'){
        try{_origSetItem(key,val);}catch(e){
            const data=JSON.parse(val);const sorted=[...data].sort((a,b)=>new Date(a.createdAt)-new Date(b.createdAt));const trimmed=sorted.slice(Math.floor(sorted.length*0.1));
            try{_origSetItem(key,JSON.stringify(trimmed));}catch(e2){console.warn('Storage full');}
        }
        return;
    }
    try{_origSetItem(key,val);}catch(e){}
};

// Init
populateAreaDropdowns();
populateFilters();
</script>
</body>
</html>